<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEMS - 장비 통합 관리 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Slate Blue Harmony -->
    <!-- Application Structure Plan: A single-page application with a fixed sidebar for primary navigation between 'Dashboard', 'Equipment Management', and 'Task Management' (Repairs/Movement). The main content area dynamically displays the selected view. This task-oriented structure allows users to easily switch between analytical overviews and specific management tasks, directly reflecting the user's workflow and the provided feature diagram. Key interactions include dynamic chart filtering, equipment searching, and a simulated AI-powered invoice parsing workflow, designed for maximum usability and clarity. -->
    <!-- Visualization & Content Choices: Dashboard uses Chart.js for key metrics (repair frequency, uptime, costs) to provide an at-a-glance overview (Goal: Inform, Compare). Equipment list is an interactive HTML table for efficient searching and sorting (Goal: Organize). Repair management features a simulated OCR/AI workflow with a user verification step, translating a complex task into a simple, guided process (Goal: Organize, Inform). This approach avoids SVG/Mermaid and uses interactive, canvas-based elements and structured HTML to best represent the system's core functionalities. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 320px; max-height: 40vh; }
        @media (max-width: 768px) { .chart-container { height: 280px; } }
        .sidebar-icon { width: 24px; height: 24px; }
        .modal-bg { background-color: rgba(0,0,0,0.5); }
        .active-nav { background-color: #2a2cc9; color: white; }
        .nav-item:hover { background-color: #2a2cc9; color: white; }
        .submenu { background-color: #1e293b; }
        .submenu .nav-item { padding-left: 2rem; }
        .submenu .nav-item:hover { background-color: #334155; }
        .submenu-toggle { transition: transform 0.2s; }
        .submenu-toggle.rotated { transform: rotate(180deg); }
        
        /* 장비 관리 탭 스타일 */
        .equipment-tab.active {
            border-bottom-color: #4338ca;
            color: #4338ca;
        }
        
        .equipment-tab-content {
            display: none;
        }
        
        .equipment-tab-content:first-child {
            display: block;
        }
        
        /* 첫 번째 탭 버튼을 기본적으로 활성화 */
        .equipment-tab:first-child {
            border-bottom-color: #2a2cc9;
            color: #2a2cc9;
        }
    </style>
</head>
<body class="bg-slate-100">

    <div class="flex h-screen">
        <!-- Sidebar Navigation -->
        <nav class="w-20 md:w-64 bg-slate-800 text-white flex flex-col">
            <div class="flex items-center justify-center md:justify-start md:pl-6 h-20 border-b border-slate-700">
                <svg class="w-8 h-8 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M12 6V4m0 16v-2M8 8l1.414-1.414M14.586 14.586L16 16m-1.414-8.014L16 8m-8.014 6.586L8 16"></path></svg>
                <span class="hidden md:block ml-3 text-xl font-bold">CEMS</span>
            </div>
            <ul class="flex-grow">
                <!-- 대시보드 -->
                <li class="nav-item active-nav p-4 md:pl-6 flex items-center cursor-pointer" onclick="switchView('dashboard')">
                    <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                    <span class="hidden md:block ml-4">대시보드</span>
                </li>
                
                <!-- 장비 대분류 -->
                <li class="nav-item p-4 md:pl-6 flex items-center cursor-pointer" onclick="toggleSubmenu('equipment-menu')">
                    <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z"></path></svg>
                    <span class="hidden md:block ml-4">장비</span>
                    <svg class="sidebar-icon ml-auto submenu-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </li>
                <!-- 장비 하위메뉴 -->
                <ul id="equipment-menu" class="submenu hidden">
                    <li class="nav-item p-4 md:pl-12 flex items-center cursor-pointer" onclick="switchView('equipment-status')">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                        <span class="hidden md:block ml-4">현황</span>
                    </li>
                    <li class="nav-item p-4 md:pl-12 flex items-center cursor-pointer" onclick="switchView('equipment-repair')">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        <span class="hidden md:block ml-4">수리</span>
                    </li>
                    <li class="nav-item p-4 md:pl-12 flex items-center cursor-pointer" onclick="switchView('equipment-education')">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                        <span class="hidden md:block ml-4">교육</span>
                    </li>
                </ul>
                
                <!-- 알림 대분류 -->
                <li class="nav-item p-4 md:pl-6 flex items-center cursor-pointer" onclick="toggleSubmenu('alarm-menu')">
                    <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4 19h6v-6H4v6zM4 5h6V4a1 1 0 00-1-1H5a1 1 0 00-1 1v1zm0 6h6v-1H4v1zm0 6h6v-1H4v1z"></path></svg>
                    <span class="hidden md:block ml-4">알림</span>
                    <svg class="sidebar-icon ml-auto submenu-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </li>
                <!-- 알림 하위메뉴 -->
                <ul id="alarm-menu" class="submenu hidden">
                    <li class="nav-item p-4 md:pl-12 flex items-center cursor-pointer" onclick="switchView('alarm-equipment')">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                        <span class="hidden md:block ml-4">장비</span>
                    </li>
                    <li class="nav-item p-4 md:pl-12 flex items-center cursor-pointer" onclick="switchView('alarm-accounting')">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span class="hidden md:block ml-4">회계</span>
                    </li>
                </ul>
                
                <!-- 회계 대분류 -->
                <li class="nav-item p-4 md:pl-6 flex items-center cursor-pointer" onclick="toggleSubmenu('accounting-menu')">
                    <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                    <span class="hidden md:block ml-4">회계</span>
                    <svg class="sidebar-icon ml-auto submenu-toggle" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </li>
                <!-- 회계 하위메뉴 -->
                <ul id="accounting-menu" class="submenu hidden">
                    <li class="nav-item p-4 md:pl-12 flex items-center cursor-pointer" onclick="switchView('accounting-purchase-request')">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                        <span class="hidden md:block ml-4">물품구매요구서</span>
                    </li>
                    <li class="nav-item p-4 md:pl-12 flex items-center cursor-pointer" onclick="switchView('accounting-quote')">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span class="hidden md:block ml-4">견적 발행</span>
                    </li>
                    <li class="nav-item p-4 md:pl-12 flex items-center cursor-pointer" onclick="switchView('accounting-transaction')">
                        <svg class="sidebar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span class="hidden md:block ml-4">거래명세서 발행</span>
                    </li>
                </ul>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            
            <!-- Dashboard View -->
            <section id="dashboard-view" class="view-section">
                <h1 class="text-3xl font-bold text-slate-800">통합 대시보드</h1>
                <p class="mt-2 text-slate-600">시스템의 핵심 지표를 통해 장비 운영 현황을 종합적으로 파악합니다.</p>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6 mt-8">
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-indigo-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-slate-500">총 장비</p>
                            <p class="text-2xl font-bold text-slate-800"><span id="kpi-total">0 대</span></p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-teal-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-slate-500">가동률</p>
                            <p class="text-2xl font-bold text-slate-800"><span id="kpi-uptime">0%</span></p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-amber-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-slate-500">월간 수리 건수</p>
                            <p class="text-2xl font-bold text-slate-800"><span id="kpi-repairs">0 건</span></p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-rose-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-rose-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-slate-500">고장 예측</p>
                            <p class="text-2xl font-bold text-slate-800"><span id="kpi-predict">0 건</span></p>
                        </div>
                    </div>
                </div>

                <div class="mt-8 grid grid-cols-1 xl:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-slate-700">품목 계열별 수리 빈도 (최근 6개월)</h3>
                        <div class="chart-container mt-4">
                            <canvas id="repairFrequencyChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-slate-700">월별 수리 비용 추이</h3>
                        <div class="chart-container mt-4">
                            <canvas id="costTrendChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Alarm Equipment View -->
            <section id="alarm-equipment-view" class="view-section hidden">
                <h1 class="text-3xl font-bold text-slate-800">장비 알림</h1>
                <p class="mt-2 text-slate-600">장비 관련 알림과 경고를 확인합니다.</p>
                
                <div class="mt-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-slate-700">장비 알림 목록</h3>
                            <div class="flex space-x-2">
                                <select id="alarm-priority-filter" class="px-3 py-2 border border-slate-300 rounded-md text-sm">
                                    <option value="all">전체 우선순위</option>
                                    <option value="high">높음</option>
                                    <option value="medium">보통</option>
                                    <option value="low">낮음</option>
                                </select>
                                <button onclick="acknowledgeAllEquipmentAlarms()" class="px-4 py-2 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700">
                                    전체 확인
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-slate-200">
                                <thead class="bg-slate-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">시간</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">시리얼번호</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">모델명</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">알림내용</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">우선순위</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">상태</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">작업</th>
                                    </tr>
                                </thead>
                                <tbody id="equipment-alarm-table">
                                    <!-- 장비 알림 데이터가 여기에 표시됩니다 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Alarm Accounting View -->
            <section id="alarm-accounting-view" class="view-section hidden">
                <h1 class="text-3xl font-bold text-slate-800">회계 알림</h1>
                <p class="mt-2 text-slate-600">회계 관련 알림과 승인 요청을 확인합니다.</p>
                
                <div class="mt-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-slate-700">회계 알림 목록</h3>
                            <div class="flex space-x-2">
                                <select id="accounting-alarm-type-filter" class="px-3 py-2 border border-slate-300 rounded-md text-sm">
                                    <option value="all">전체 유형</option>
                                    <option value="document">거래명세서 발행</option>
                                    <option value="deadline">납기 지연</option>
                                    <option value="approval">결재 지연</option>
                                </select>
                                <button onclick="acknowledgeAllAccountingAlarms()" class="px-4 py-2 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700">
                                    전체 확인
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-slate-200">
                                <thead class="bg-slate-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">시간</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">유형</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">내용</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">금액</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">상태</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b">작업</th>
                                    </tr>
                                </thead>
                                <tbody id="accounting-alarm-table">
                                    <!-- 회계 알림 데이터가 여기에 표시됩니다 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Accounting Views -->
            <!-- 물품구매요구서 뷰 -->
            <section id="accounting-purchase-request-view" class="view-section hidden">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h1 class="text-3xl font-bold text-slate-800">물품구매요구서</h1>
                        <p class="mt-2 text-slate-600">물품 구매 요구서를 작성하고 결재 상신 및 출력을 관리합니다.</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="printPurchaseRequestForm()" 
                                class="px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                            출력
                        </button>
                        <button onclick="submitForApproval()" 
                                class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                            결재상신
                        </button>
                    </div>
                </div>

                <!-- 물품구매요구서 양식 -->
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold text-slate-800">물품구매요구서</h2>
                    </div>

                    <!-- 결재선 -->
                    <div class="flex justify-end mb-6">
                        <div class="border border-slate-300 rounded-md overflow-hidden">
                            <table class="text-sm">
                                <thead class="bg-slate-100">
                                    <tr>
                                        <th class="px-4 py-2 border-r border-slate-300">담당자</th>
                                        <th class="px-4 py-2 border-r border-slate-300">기술 책임자</th>
                                        <th class="px-4 py-2 border-r border-slate-300">품질 책임자</th>
                                        <th class="px-4 py-2 border-r border-slate-300">부사장</th>
                                        <th class="px-4 py-2">사장</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="px-4 py-6 border-r border-slate-300 text-center text-slate-500">서명</td>
                                        <td class="px-4 py-6 border-r border-slate-300 text-center text-slate-500">서명</td>
                                        <td class="px-4 py-6 border-r border-slate-300 text-center text-slate-500">서명</td>
                                        <td class="px-4 py-6 border-r border-slate-300 text-center text-slate-500">서명</td>
                                        <td class="px-4 py-6 text-center text-slate-500">서명</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 기본 정보 -->
                    <div class="grid grid-cols-3 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">작성일자</label>
                            <input type="date" id="preparation-date" 
                                   class="w-full px-3 py-2 border border-slate-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">구입부서</label>
                            <select id="purchase-department" class="w-full px-3 py-2 border border-slate-300 rounded-md">
                                <option value="">부서 선택</option>
                                <option value="기술팀">기술팀</option>
                                <option value="운영팀">운영팀</option>
                                <option value="정비팀">정비팀</option>
                                <option value="품질팀">품질팀</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">구입사유</label>
                            <input type="text" id="purchase-reason" placeholder="구입 사유를 입력하세요" 
                                   class="w-full px-3 py-2 border border-slate-300 rounded-md">
                        </div>
                    </div>

                    <!-- 품목 상세 테이블 -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">품목 상세</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full border border-slate-300">
                                <thead class="bg-slate-100">
                                    <tr>
                                        <th class="border border-slate-300 px-3 py-2 text-sm font-medium">품명</th>
                                        <th class="border border-slate-300 px-3 py-2 text-sm font-medium">규격</th>
                                        <th class="border border-slate-300 px-3 py-2 text-sm font-medium">수량</th>
                                        <th class="border border-slate-300 px-3 py-2 text-sm font-medium">예상금액</th>
                                        <th class="border border-slate-300 px-3 py-2 text-sm font-medium">공급대상업체</th>
                                        <th class="border border-slate-300 px-3 py-2 text-sm font-medium">기타</th>
                                    </tr>
                                </thead>
                                <tbody id="item-details-table">
                                    <!-- 12개 행 동적 생성 -->
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-3">
                            <button onclick="addItemRow()" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm">
                                품목 추가
                            </button>
                        </div>
                    </div>

                    <!-- 합계 정보 -->
                    <div class="grid grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">합계</label>
                            <input type="text" id="total-amount" readonly 
                                   class="w-full px-3 py-2 border border-slate-300 rounded-md bg-slate-50 text-right" value="₩0">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">부가세</label>
                            <input type="text" id="vat-amount" readonly 
                                   class="w-full px-3 py-2 border border-slate-300 rounded-md bg-slate-50 text-right" value="₩0">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">총금액</label>
                            <input type="text" id="grand-total" readonly 
                                   class="w-full px-3 py-2 border border-slate-300 rounded-md bg-slate-50 text-right" value="₩0">
                        </div>
                    </div>

                    <!-- 하단 정보 -->
                    <div class="mt-8 pt-6 border-t border-slate-300 flex justify-between text-sm text-slate-500">
                        <span>CM-QP-04-F07</span>
                        <span>회차 청명기연환경</span>
                        <span>A4(210×297mm)</span>
                    </div>
                </div>
            </section>

            <!-- 견적서 발행 뷰 -->
            <section id="accounting-quote-view" class="view-section hidden">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h1 class="text-3xl font-bold text-slate-800">견적서 발행</h1>
                        <p class="mt-2 text-slate-600">물품구매요구서에서 DB를 가져와 견적을 작성하고 발행합니다.</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- DB 가져오기 -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">구매요구서에서 DB 가져오기</h3>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">승인된 구매요구서 선택</label>
                            <select id="approved-request-select" class="w-full px-3 py-2 border border-slate-300 rounded-md">
                                <option value="">구매요구서를 선택하세요</option>
                                <option value="PR-2025-001">PR-2025-001 - MP-가스30KN 센서</option>
                                <option value="PR-2025-002">PR-2025-002 - SO2 Serinus50i 부품</option>
                                <option value="PR-2025-003">PR-2025-003 - PM-2.5 PMS-204 모듈</option>
                            </select>
                        </div>
                        <button onclick="loadDBFromRequest()" 
                                class="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            DB 가져오기
                        </button>
                    </div>

                    <!-- 견적서 작성 -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">견적서 작성</h3>
                        <form class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">견적서 번호</label>
                                <input type="text" id="quote-number" value="QT-2025-001" readonly 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-md bg-slate-50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">공급업체</label>
                                <select id="supplier" class="w-full px-3 py-2 border border-slate-300 rounded-md">
                                    <option value="">공급업체를 선택하세요</option>
                                    <option value="정밀기기솔루션">정밀기기솔루션</option>
                                    <option value="기기수리센터">기기수리센터</option>
                                    <option value="환경측정기기">환경측정기기</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">품목명</label>
                                <input type="text" id="quote-item-name" readonly 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-md bg-slate-50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">수량</label>
                                <input type="number" id="quote-quantity" min="1" 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-md" onchange="calculateQuoteAmount()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">단가</label>
                                <input type="number" id="unit-price" placeholder="단가를 입력하세요" 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-md" onchange="calculateQuoteAmount()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">공급가액</label>
                                <input type="text" id="supply-amount" readonly 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-md bg-slate-50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">부가세</label>
                                <input type="text" id="vat-amount" readonly 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-md bg-slate-50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">공급총액</label>
                                <input type="text" id="total-amount" readonly 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-md bg-slate-50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">납기</label>
                                <input type="date" id="delivery-date" 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">특이사항</label>
                                <textarea id="quote-notes" rows="3" placeholder="특이사항을 입력하세요" 
                                          class="w-full px-3 py-2 border border-slate-300 rounded-md"></textarea>
                            </div>
                            <div class="flex gap-3">
                                <button type="button" onclick="saveQuotation()" 
                                        class="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                                    저장
                                </button>
                                <button type="button" onclick="issueQuotation()" 
                                        class="flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                                    견적 발행
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- 거래명세서 뷰 -->
            <section id="accounting-transaction-view" class="view-section hidden">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h1 class="text-3xl font-bold text-slate-800">거래명세서</h1>
                        <p class="mt-2 text-slate-600">입고내역 업로드, 견적서 DB 연동 및 거래명세서 출력을 관리합니다.</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 입고내역 업로드 -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">입고내역 업로드</h3>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">입고내역 파일 (Excel)</label>
                            <input type="file" id="inventory-upload" accept=".xlsx,.xls" 
                                   class="w-full px-3 py-2 border border-slate-300 rounded-md">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">입고일자</label>
                            <input type="date" id="inventory-date" 
                                   class="w-full px-3 py-2 border border-slate-300 rounded-md">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">입고처</label>
                            <input type="text" id="inventory-location" placeholder="입고처를 입력하세요" 
                                   class="w-full px-3 py-2 border border-slate-300 rounded-md">
                        </div>
                        <button onclick="uploadInventory()" 
                                class="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            업로드
                        </button>
                    </div>

                    <!-- 견적서 DB 가져오기 -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">견적서 DB 가져오기</h3>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">견적서 선택</label>
                            <select id="quote-select" class="w-full px-3 py-2 border border-slate-300 rounded-md">
                                <option value="">견적서를 선택하세요</option>
                                <option value="QT-2025-001">QT-2025-001 - MP-가스30KN 센서</option>
                                <option value="QT-2025-002">QT-2025-002 - SO2 Serinus50i 부품</option>
                                <option value="QT-2025-003">QT-2025-003 - PM-2.5 PMS-204 모듈</option>
                            </select>
                        </div>
                        <button onclick="loadQuoteData()" 
                                class="w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                            데이터 가져오기
                        </button>
                    </div>
                </div>

                <!-- 거래명세서 출력 및 알림 -->
                <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">거래명세서 출력</h3>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">거래명세서 번호</label>
                            <input type="text" id="transaction-number" value="TS-2025-001" readonly 
                                   class="w-full px-3 py-2 border border-slate-300 rounded-md bg-slate-50">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">출력 형식</label>
                            <select id="print-format" class="w-full px-3 py-2 border border-slate-300 rounded-md">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                                <option value="word">Word</option>
                            </select>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="printTransactionSpec()" 
                                    class="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                                출력
                            </button>
                            <button onclick="downloadTransactionSpec()" 
                                    class="flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                                다운로드
                            </button>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">알림 전송</h3>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">수신자</label>
                            <select id="notification-recipient" class="w-full px-3 py-2 border border-slate-300 rounded-md">
                                <option value="all">전체 직원</option>
                                <option value="accounting">회계팀</option>
                                <option value="purchase">구매팀</option>
                                <option value="technical">기술팀</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">알림 내용</label>
                            <textarea id="notification-content" rows="4" placeholder="알림 내용을 입력하세요" 
                                      class="w-full px-3 py-2 border border-slate-300 rounded-md"></textarea>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="sendNotification()" 
                                    class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                알림 전송
                            </button>
                            <button onclick="scheduleNotification()" 
                                    class="flex-1 px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700">
                                예약 전송
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Equipment Management View -->
            <section id="equipment-view" class="view-section hidden">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h1 class="text-3xl font-bold text-slate-800">장비 관리</h1>
                        <p class="mt-2 text-slate-600">장비 현황, 수리, 교육을 통합 관리합니다.</p>
                    </div>
                </div>

                <!-- Equipment Tab Navigation -->
                <div class="border-b border-slate-200 mb-6">
                    <nav class="flex space-x-8">
                        <button class="equipment-tab py-2 px-1 border-b-2 border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300 active" 
                                onclick="switchEquipmentTab('status')">
                            현황
                        </button>
                        <button class="equipment-tab py-2 px-1 border-b-2 border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300" 
                                onclick="switchEquipmentTab('repair')">
                            수리
                        </button>
                        <button class="equipment-tab py-2 px-1 border-b-2 border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300" 
                                onclick="switchEquipmentTab('education')">
                            교육
                        </button>
                    </nav>
                </div>

                <!-- Status Tab Content -->
                <div id="equipment-status" class="equipment-tab-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- 전체 재고 현황 -->
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4">전체 재고 현황</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-slate-50 rounded">
                                    <span class="font-medium">총 장비 수</span>
                                    <span class="text-indigo-600 font-bold" id="total-equipment-count">0</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-slate-50 rounded">
                                    <span class="font-medium">가동 중</span>
                                    <span class="text-green-600 font-bold" id="operating-count">0</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-slate-50 rounded">
                                    <span class="font-medium">수리 중</span>
                                    <span class="text-yellow-600 font-bold" id="repair-count">0</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-slate-50 rounded">
                                    <span class="font-medium">대기 중</span>
                                    <span class="text-slate-600 font-bold" id="waiting-count">0</span>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h4 class="font-medium text-slate-700 mb-2">장비별 위치 및 사용 내용</h4>
                                <div class="max-h-64 overflow-y-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-slate-100">
                                            <tr>
                                                <th class="text-left p-2">장비명</th>
                                                <th class="text-left p-2">위치</th>
                                                <th class="text-left p-2">상태</th>
                                            </tr>
                                        </thead>
                                        <tbody id="equipment-location-table">
                                            <!-- 동적으로 생성됨 -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- 재고 조회 -->
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4">재고 조회</h3>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-slate-700 mb-2">시리얼 번호 검색</label>
                                <div class="flex">
                                    <input type="text" id="serial-search" placeholder="시리얼 번호를 입력하세요" 
                                           class="flex-1 px-3 py-2 border border-slate-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <button onclick="searchEquipment()" 
                                            class="px-4 py-2 bg-indigo-600 text-white rounded-r-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        검색
                                    </button>
                                </div>
                            </div>
                            
                            <div id="equipment-detail" class="hidden">
                                <div class="border-t pt-4">
                                    <h4 class="font-medium text-slate-700 mb-3">장비 상세 정보</h4>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-slate-600">가동률:</span>
                                            <span class="font-medium" id="equipment-uptime">-</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-slate-600">수리 내역:</span>
                                            <span class="font-medium" id="repair-history-count">-</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-slate-600">정도 검사:</span>
                                            <span class="font-medium" id="calibration-status">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Repair Tab Content -->
                <div id="equipment-repair" class="equipment-tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- 수리 현황 -->
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4">수리 현황</h3>
                            <div class="space-y-4">
                                <div class="border rounded-lg p-4 cursor-pointer hover:bg-slate-50" onclick="showRepairDetail('770654')">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h4 class="font-medium text-slate-800">(PM-10) MP-가30KN가</h4>
                                            <p class="text-sm text-slate-600">시리얼: 770654</p>
                                        </div>
                                        <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">수리 중</span>
                                    </div>
                                    <div class="mt-2 text-sm text-slate-500">
                                        <p>최근 입고: 2024-01-15</p>
                                        <p>예상 완료: 2024-01-20</p>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 cursor-pointer hover:bg-slate-50" onclick="showRepairDetail('770655')">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h4 class="font-medium text-slate-800">(PM-10) MP-가30KN가</h4>
                                            <p class="text-sm text-slate-600">시리얼: 770655</p>
                                        </div>
                                        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">수리 완료</span>
                                    </div>
                                    <div class="mt-2 text-sm text-slate-500">
                                        <p>최근 입고: 2024-01-12</p>
                                        <p>완료일: 2024-01-18</p>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 cursor-pointer hover:bg-slate-50" onclick="showRepairDetail('17-1733')">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h4 class="font-medium text-slate-800">(SO2) Serinus50i</h4>
                                            <p class="text-sm text-slate-600">시리얼: 17-1733</p>
                                        </div>
                                        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">수리 완료</span>
                                    </div>
                                    <div class="mt-2 text-sm text-slate-500">
                                        <p>최근 입고: 2024-01-10</p>
                                        <p>완료일: 2024-01-18</p>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 cursor-pointer hover:bg-slate-50" onclick="showRepairDetail('17-1906')">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h4 class="font-medium text-slate-800">(SO2) Serinus50i</h4>
                                            <p class="text-sm text-slate-600">시리얼: 17-1906</p>
                                        </div>
                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">점검 중</span>
                                    </div>
                                    <div class="mt-2 text-sm text-slate-500">
                                        <p>최근 입고: 2024-01-16</p>
                                        <p>예상 완료: 2024-01-22</p>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 cursor-pointer hover:bg-slate-50" onclick="showRepairDetail('1501478')">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h4 class="font-medium text-slate-800">(PM-2.5) PMS-204</h4>
                                            <p class="text-sm text-slate-600">시리얼: 1501478</p>
                                        </div>
                                        <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">수리 중</span>
                                    </div>
                                    <div class="mt-2 text-sm text-slate-500">
                                        <p>최근 입고: 2024-01-14</p>
                                        <p>예상 완료: 2024-01-21</p>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 cursor-pointer hover:bg-slate-50" onclick="showRepairDetail('19P404')">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h4 class="font-medium text-slate-800">(PM-2.5) KMS-4200</h4>
                                            <p class="text-sm text-slate-600">시리얼: 19P404</p>
                                        </div>
                                        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">수리 완료</span>
                                    </div>
                                    <div class="mt-2 text-sm text-slate-500">
                                        <p>최근 입고: 2024-01-08</p>
                                        <p>완료일: 2024-01-15</p>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 cursor-pointer hover:bg-slate-50" onclick="showRepairDetail('T25861')">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h4 class="font-medium text-slate-800">(PM-2.5) E-BAM</h4>
                                            <p class="text-sm text-slate-600">시리얼: T25861</p>
                                        </div>
                                        <span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">긴급 수리</span>
                                    </div>
                                    <div class="mt-2 text-sm text-slate-500">
                                        <p>최근 입고: 2024-01-17</p>
                                        <p>예상 완료: 2024-01-19</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 수리 내역 업로드 -->
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4">수리 내역 업로드</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">업체 선택</label>
                                    <select id="repair-company" class="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="">업체를 선택하세요</option>
                                        <option value="company1">청명테크</option>
                                        <option value="company2">한국기술</option>
                                        <option value="company3">대한장비</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">수리 거래명세서 (PDF)</label>
                                    <div class="border-2 border-dashed border-slate-300 rounded-lg p-6 text-center">
                                        <svg class="mx-auto h-12 w-12 text-slate-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                        <div class="mt-4">
                                            <label for="pdf-upload" class="cursor-pointer bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">
                                                PDF 파일 선택
                                            </label>
                                            <input id="pdf-upload" type="file" accept=".pdf" class="hidden" onchange="handlePdfUpload(event)">
                                        </div>
                                        <p class="mt-2 text-sm text-slate-500">PDF 파일을 드래그하거나 클릭하여 선택하세요</p>
                                    </div>
                                </div>
                                
                                <button onclick="uploadRepairReport()" 
                                        class="w-full px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    업로드
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Education Tab Content -->
                <div id="equipment-education" class="equipment-tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- 매뉴얼 -->
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4">장비 매뉴얼</h3>
                            <div class="space-y-3">
                                <div class="border rounded-lg p-4 hover:bg-slate-50 cursor-pointer" onclick="openManual('mp-manual')">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <svg class="w-8 h-8 text-red-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd" />
                                            </svg>
                                            <div>
                                                <h4 class="font-medium text-slate-800">(PM-10) MP-가30KN가 매뉴얼</h4>
                                                <p class="text-sm text-slate-600">설치 및 운영 가이드 v2.1</p>
                                            </div>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 hover:bg-slate-50 cursor-pointer" onclick="openManual('serinus-manual')">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <svg class="w-8 h-8 text-blue-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd" />
                                            </svg>
                                            <div>
                                                <h4 class="font-medium text-slate-800">(SO2) Serinus50i 매뉴얼</h4>
                                                <p class="text-sm text-slate-600">사용법 및 유지보수 v3.0</p>
                                            </div>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 hover:bg-slate-50 cursor-pointer" onclick="openManual('pms-manual')">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <svg class="w-8 h-8 text-green-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd" />
                                            </svg>
                                            <div>
                                                <h4 class="font-medium text-slate-800">(PM-2.5) PMS-204 매뉴얼</h4>
                                                <p class="text-sm text-slate-600">설정 및 보정 방법 v1.8</p>
                                            </div>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 hover:bg-slate-50 cursor-pointer" onclick="openManual('kms-manual')">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <svg class="w-8 h-8 text-purple-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd" />
                                            </svg>
                                            <div>
                                                <h4 class="font-medium text-slate-800">(PM-2.5) KMS-4200 매뉴얼</h4>
                                                <p class="text-sm text-slate-600">베타선 측정 가이드 v2.2</p>
                                            </div>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 hover:bg-slate-50 cursor-pointer" onclick="openManual('ebam-manual')">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <svg class="w-8 h-8 text-orange-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd" />
                                            </svg>
                                            <div>
                                                <h4 class="font-medium text-slate-800">(PM-2.5) E-BAM 매뉴얼</h4>
                                                <p class="text-sm text-slate-600">베타선 흡수 측정법 v1.5</p>
                                            </div>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 교육 자료 -->
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4">교육 자료</h3>
                            <div class="space-y-3">
                                <div class="border rounded-lg p-4 hover:bg-slate-50 cursor-pointer" onclick="openTraining('safety-training')">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <svg class="w-8 h-8 text-yellow-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                                            </svg>
                                            <div>
                                                <h4 class="font-medium text-slate-800">안전 교육 동영상</h4>
                                                <p class="text-sm text-slate-600">장비 사용 시 안전 수칙 (45분)</p>
                                                <p class="text-sm text-slate-600">장비 사용 시 안전 수칙</p>
                                            </div>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 hover:bg-slate-50 cursor-pointer" onclick="openTraining('maintenance-training')">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <svg class="w-8 h-8 text-purple-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
                                            </svg>
                                            <div>
                                                <h4 class="font-medium text-slate-800">정기점검 가이드</h4>
                                                <p class="text-sm text-slate-600">월별/분기별 점검 항목</p>
                                            </div>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 hover:bg-slate-50 cursor-pointer" onclick="openTraining('troubleshooting')">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <svg class="w-8 h-8 text-indigo-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                            </svg>
                                            <div>
                                                <h4 class="font-medium text-slate-800">문제 해결 가이드</h4>
                                                <p class="text-sm text-slate-600">일반적인 오류 및 해결방법</p>
                                            </div>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Alarms View -->
            <section id="alarms-view" class="view-section hidden">
                <h1 class="text-3xl font-bold text-slate-800">알람 관리</h1>
                <p class="mt-2 text-slate-600">시스템 알람과 장비 상태 알림을 관리하고 모니터링합니다.</p>

                <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                    <div class="flex flex-col md:flex-row gap-4 mb-6">
                        <select id="alarmTypeFilter" class="p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none">
                            <option value="all">모든 알람 유형</option>
                            <option value="정도검사 임박">정도검사 임박</option>
                            <option value="장기간 입고">장기간 입고</option>
                            <option value="가동 저하">가동 저하</option>
                            <option value="입고 내역">입고 내역</option>
                            <option value="결제 생성">결제 생성</option>
                        </select>
                        <select id="alarmStatusFilter" class="p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none">
                            <option value="all">모든 상태</option>
                            <option value="미확인">미확인</option>
                            <option value="확인됨">확인됨</option>
                            <option value="처리중">처리중</option>
                        </select>
                        <button onclick="acknowledgeAllAlarms()" class="p-2 px-4 bg-green-600 text-white rounded-md hover:bg-green-700">전체 확인</button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b">
                                <tr>
                                    <th class="p-4 font-semibold">시간</th>
                                    <th class="p-4 font-semibold">알람 유형</th>
                                    <th class="p-4 font-semibold">장비 S/N</th>
                                    <th class="p-4 font-semibold">메시지</th>
                                    <th class="p-4 font-semibold">우선순위</th>
                                    <th class="p-4 font-semibold">상태</th>
                                    <th class="p-4 font-semibold">작업</th>
                                </tr>
                            </thead>
                            <tbody id="alarmsTableBody">
                                <!-- JS will populate this -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Control Panel View -->
            <section id="control-view" class="view-section hidden">
                <h1 class="text-3xl font-bold text-slate-800">제어 패널</h1>
                <p class="mt-2 text-slate-600">장비를 선택하고 원격으로 제어하며 스케줄을 관리합니다.</p>

                <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">장비 제어</h2>
                        <div class="mb-4">
                            <label for="control-equipment" class="block text-sm font-medium text-slate-700">장비 선택</label>
                            <select id="control-equipment" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="">장비를 선택하세요</option>
                                <option value="CM-GA-001">CM-GA-001 (가스 분석기)</option>
                                <option value="CM-GA-015">CM-GA-015 (가스 분석기)</option>
                                <option value="CM-FM-007">CM-FM-007 (유량 측정기)</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <button onclick="sendCommand('start')" class="bg-green-600 text-white font-bold py-3 px-4 rounded-md hover:bg-green-700">시작</button>
                            <button onclick="sendCommand('stop')" class="bg-red-600 text-white font-bold py-3 px-4 rounded-md hover:bg-red-700">정지</button>
                            <button onclick="sendCommand('open')" class="bg-blue-600 text-white font-bold py-3 px-4 rounded-md hover:bg-blue-700">열림</button>
                            <button onclick="sendCommand('close')" class="bg-yellow-600 text-white font-bold py-3 px-4 rounded-md hover:bg-yellow-700">닫힘</button>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-md">
                            <h4 class="font-medium text-slate-700 mb-2">명령 전송 로그</h4>
                            <div id="commandLog" class="text-sm text-slate-600 space-y-1">
                                <div>2025-01-20 14:30:15 - CM-GA-001 시작 명령 전송됨</div>
                                <div>2025-01-20 14:25:30 - CM-FM-007 정지 명령 전송됨</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">스케줄 관리</h2>
                        <div class="mb-4">
                            <label for="schedule-equipment" class="block text-sm font-medium text-slate-700">장비</label>
                            <select id="schedule-equipment" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="">장비를 선택하세요</option>
                                <option value="CM-GA-001">CM-GA-001</option>
                                <option value="CM-GA-015">CM-GA-015</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="schedule-time" class="block text-sm font-medium text-slate-700">실행 시간</label>
                            <input type="datetime-local" id="schedule-time" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="mb-4">
                            <label for="schedule-command" class="block text-sm font-medium text-slate-700">명령</label>
                            <select id="schedule-command" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="start">시작</option>
                                <option value="stop">정지</option>
                                <option value="restart">재시작</option>
                            </select>
                        </div>
                        <button onclick="addSchedule()" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700">스케줄 추가</button>
                        
                        <div class="mt-6">
                            <h4 class="font-medium text-slate-700 mb-2">등록된 스케줄</h4>
                            <div id="scheduleList" class="space-y-2">
                                <div class="flex justify-between items-center p-2 bg-slate-50 rounded">
                                    <span class="text-sm">CM-GA-001 - 2025-01-21 09:00 시작</span>
                                    <button onclick="removeSchedule(0)" class="text-red-600 hover:text-red-800">삭제</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reports View -->
            <section id="reports-view" class="view-section hidden">
                <h1 class="text-3xl font-bold text-slate-800">리포트</h1>
                <p class="mt-2 text-slate-600">장비 현황과 운영 데이터를 분석하여 다양한 리포트를 생성합니다.</p>

                <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">주간 리포트 생성</h2>
                        <div class="mb-4">
                            <label for="report-period" class="block text-sm font-medium text-slate-700">보고 기간</label>
                            <select id="report-period" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="weekly">주간</option>
                                <option value="monthly">월간</option>
                                <option value="quarterly">분기</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="report-type" class="block text-sm font-medium text-slate-700">리포트 유형</label>
                            <select id="report-type" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="equipment-status">장비 현황</option>
                                <option value="repair-summary">수리 요약</option>
                                <option value="cost-analysis">비용 분석</option>
                                <option value="movement-log">이동 로그</option>
                            </select>
                        </div>
                        <button onclick="generateReport()" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700">리포트 생성</button>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">데이터 내보내기</h2>
                        <div class="mb-4">
                            <label for="export-format" class="block text-sm font-medium text-slate-700">파일 형식</label>
                            <select id="export-format" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="csv">CSV</option>
                                <option value="excel">Excel</option>
                                <option value="pdf">PDF</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="export-data" class="block text-sm font-medium text-slate-700">데이터 범위</label>
                            <select id="export-data" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="all">전체 데이터</option>
                                <option value="equipment">장비 목록</option>
                                <option value="repairs">수리 이력</option>
                                <option value="movements">이동 이력</option>
                                <option value="alarms">알람 로그</option>
                            </select>
                        </div>
                        <button onclick="exportData()" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-md hover:bg-green-700">데이터 내보내기</button>
                    </div>
                </div>

                <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-bold text-slate-800 mb-4">생성된 리포트</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b">
                                <tr>
                                    <th class="p-4 font-semibold">생성일</th>
                                    <th class="p-4 font-semibold">리포트명</th>
                                    <th class="p-4 font-semibold">유형</th>
                                    <th class="p-4 font-semibold">크기</th>
                                    <th class="p-4 font-semibold">작업</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b">
                                    <td class="p-4">2025-01-20</td>
                                    <td class="p-4">2025년 1주차 장비 현황 리포트</td>
                                    <td class="p-4">장비 현황</td>
                                    <td class="p-4">2.3 MB</td>
                                    <td class="p-4">
                                        <button class="text-indigo-600 hover:text-indigo-800 mr-2">다운로드</button>
                                        <button class="text-red-600 hover:text-red-800">삭제</button>
                                    </td>
                                </tr>
                                <tr class="border-b">
                                    <td class="p-4">2025-01-13</td>
                                    <td class="p-4">2024년 12월 수리 요약 리포트</td>
                                    <td class="p-4">수리 요약</td>
                                    <td class="p-4">1.8 MB</td>
                                    <td class="p-4">
                                        <button class="text-indigo-600 hover:text-indigo-800 mr-2">다운로드</button>
                                        <button class="text-red-600 hover:text-red-800">삭제</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- API Test View -->
            <section id="api-test-view" class="view-section hidden">
                <h1 class="text-3xl font-bold text-slate-800">API 테스트</h1>
                <p class="mt-2 text-slate-600">외부 연동 API와 이슈 등록 API를 테스트합니다.</p>

                <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">이슈 등록 API</h2>
                        <form id="issueForm" class="space-y-4">
                            <div>
                                <label for="issue-title" class="block text-sm font-medium text-slate-700">이슈 제목</label>
                                <input type="text" id="issue-title" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="이슈 제목을 입력하세요">
                            </div>
                            <div>
                                <label for="issue-description" class="block text-sm font-medium text-slate-700">이슈 설명</label>
                                <textarea id="issue-description" rows="4" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="이슈에 대한 자세한 설명을 입력하세요"></textarea>
                            </div>
                            <div>
                                <label for="issue-priority" class="block text-sm font-medium text-slate-700">우선순위</label>
                                <select id="issue-priority" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="low">낮음</option>
                                    <option value="medium">보통</option>
                                    <option value="high">높음</option>
                                    <option value="critical">긴급</option>
                                </select>
                            </div>
                            <div>
                                <label for="issue-category" class="block text-sm font-medium text-slate-700">카테고리</label>
                                <select id="issue-category" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="bug">버그</option>
                                    <option value="feature">기능 요청</option>
                                    <option value="improvement">개선 사항</option>
                                    <option value="other">기타</option>
                                </select>
                            </div>
                            <button type="button" onclick="submitIssue()" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700">이슈 등록</button>
                        </form>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">외부 연동 API 테스트</h2>
                        <div class="mb-4">
                            <label for="api-endpoint" class="block text-sm font-medium text-slate-700">API 엔드포인트</label>
                            <select id="api-endpoint" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="e-count">이카운트 API</option>
                                <option value="inventory">재고 관리 API</option>
                                <option value="maintenance">정비 관리 API</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="api-method" class="block text-sm font-medium text-slate-700">HTTP 메서드</label>
                            <select id="api-method" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="api-params" class="block text-sm font-medium text-slate-700">요청 파라미터 (JSON)</label>
                            <textarea id="api-params" rows="4" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder='{"key": "value"}'></textarea>
                        </div>
                        <button onclick="testAPI()" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-md hover:bg-green-700">API 테스트</button>
                        
                        <div class="mt-6">
                            <h4 class="font-medium text-slate-700 mb-2">응답 결과</h4>
                            <div id="apiResponse" class="bg-slate-50 p-4 rounded-md text-sm font-mono">
                                API 응답이 여기에 표시됩니다.
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-bold text-slate-800 mb-4">API 호출 이력</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b">
                                <tr>
                                    <th class="p-4 font-semibold">시간</th>
                                    <th class="p-4 font-semibold">API</th>
                                    <th class="p-4 font-semibold">메서드</th>
                                    <th class="p-4 font-semibold">상태</th>
                                    <th class="p-4 font-semibold">응답 시간</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b">
                                    <td class="p-4">2025-01-20 14:30:15</td>
                                    <td class="p-4">이카운트 API</td>
                                    <td class="p-4">GET</td>
                                    <td class="p-4"><span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">성공</span></td>
                                    <td class="p-4">245ms</td>
                                </tr>
                                <tr class="border-b">
                                    <td class="p-4">2025-01-20 14:25:30</td>
                                    <td class="p-4">재고 관리 API</td>
                                    <td class="p-4">POST</td>
                                    <td class="p-4"><span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">실패</span></td>
                                    <td class="p-4">1.2s</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Settings View -->
            <section id="settings-view" class="view-section hidden">
                <h1 class="text-3xl font-bold text-slate-800">설정</h1>
                <p class="mt-2 text-slate-600">시스템 테마와 사이트 설정을 관리합니다.</p>

                <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">테마 설정</h2>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">색상 테마</label>
                            <div class="grid grid-cols-3 gap-3">
                                <button onclick="setTheme('white-blue')" class="theme-option p-4 border-2 border-slate-300 rounded-lg hover:border-indigo-500 focus:border-indigo-500 focus:outline-none">
                                    <div class="w-full h-8 bg-gradient-to-r from-white to-blue-100 rounded mb-2"></div>
                                    <span class="text-sm">화이트/블루</span>
                                </button>
                                <button onclick="setTheme('dark')" class="theme-option p-4 border-2 border-slate-300 rounded-lg hover:border-indigo-500 focus:border-indigo-500 focus:outline-none">
                                    <div class="w-full h-8 bg-gradient-to-r from-slate-800 to-slate-600 rounded mb-2"></div>
                                    <span class="text-sm">다크</span>
                                </button>
                                <button onclick="setTheme('light')" class="theme-option p-4 border-2 border-slate-300 rounded-lg hover:border-indigo-500 focus:border-indigo-500 focus:outline-none">
                                    <div class="w-full h-8 bg-gradient-to-r from-gray-100 to-gray-300 rounded mb-2"></div>
                                    <span class="text-sm">라이트</span>
                                </button>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700">레이아웃</label>
                            <div class="mt-2 flex gap-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="layout" value="sidebar" class="form-radio text-indigo-600" checked>
                                    <span class="ml-2">사이드바</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="layout" value="topbar" class="form-radio text-indigo-600">
                                    <span class="ml-2">탑바</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">사이트 설정</h2>
                        <div class="mb-4">
                            <label for="site-name" class="block text-sm font-medium text-slate-700">사이트명</label>
                            <input type="text" id="site-name" value="청명기연환경 장비관리시스템" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="mb-4">
                            <label for="company-name" class="block text-sm font-medium text-slate-700">회사명</label>
                            <input type="text" id="company-name" value="(주)청명기연환경" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="mb-4">
                            <label for="timezone" class="block text-sm font-medium text-slate-700">시간대</label>
                            <select id="timezone" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="Asia/Seoul" selected>Asia/Seoul (UTC+9)</option>
                                <option value="UTC">UTC</option>
                                <option value="America/New_York">America/New_York</option>
                            </select>
                        </div>
                        <button onclick="saveSettings()" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700">설정 저장</button>
                    </div>
                </div>

                <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-bold text-slate-800 mb-4">데이터 관리</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="exportSettings()" class="p-4 border-2 border-dashed border-slate-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-colors">
                            <div class="text-center">
                                <svg class="w-8 h-8 text-indigo-600 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                <p class="font-medium">설정 내보내기</p>
                            </div>
                        </button>
                        <button onclick="importSettings()" class="p-4 border-2 border-dashed border-slate-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-colors">
                            <div class="text-center">
                                <svg class="w-8 h-8 text-indigo-600 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                <p class="font-medium">설정 가져오기</p>
                            </div>
                        </button>
                        <button onclick="resetSettings()" class="p-4 border-2 border-dashed border-red-300 rounded-lg hover:border-red-500 hover:bg-red-50 transition-colors">
                            <div class="text-center">
                                <svg class="w-8 h-8 text-red-600 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                                <p class="font-medium">설정 초기화</p>
                            </div>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Tasks View -->
            <section id="tasks-view" class="view-section hidden">
                <h1 class="text-3xl font-bold text-slate-800">업무 관리</h1>
                <p class="mt-2 text-slate-600">장비 입/출고를 기록하고, 수리 내역을 등록 및 관리합니다.</p>

                 <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">수리 내역 자동 등록</h2>
                        <p class="text-slate-600 mb-4">수리 거래명세서나 견적서(PDF, Excel)를 업로드하면 AI가 내용을 분석하여 자동으로 수리 내역을 추출합니다.</p>
                        <div id="dropzone" class="border-2 border-dashed border-slate-300 rounded-lg p-10 text-center cursor-pointer hover:border-indigo-500 hover:bg-indigo-50 transition-colors">
                            <p class="text-slate-500">여기에 파일을 드래그 앤 드롭하거나 클릭하여 업로드하세요.</p>
                            <input type="file" id="fileUpload" class="hidden">
                        </div>
                        <div id="upload-progress" class="hidden mt-4 w-full bg-gray-200 rounded-full h-2.5">
                           <div class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">입/출고 기록</h2>
                        <form>
                            <div class="mb-4">
                                <label for="movement-sn" class="block text-sm font-medium text-slate-700">장비 S/N</label>
                                <input type="text" id="movement-sn" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-slate-700">이동 형태</label>
                                <div class="mt-2 flex gap-4">
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="movement-type" value="출고" class="form-radio text-indigo-600">
                                        <span class="ml-2">출고 (현장으로)</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="movement-type" value="입고" class="form-radio text-indigo-600">
                                        <span class="ml-2">입고 (본사로)</span>
                                    </label>
                                </div>
                            </div>
                             <div class="mb-4">
                                <label for="movement-location" class="block text-sm font-medium text-slate-700">현장/위치</label>
                                <input type="text" id="movement-location" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <button type="button" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                기록 저장
                            </button>
                        </form>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Equipment Detail Modal -->
    <div id="detailModal" class="fixed inset-0 modal-bg z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl h-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-xl font-bold text-slate-800">장비 상세 정보: <span id="modal-sn"></span></h2>
                <button onclick="closeModal('detailModal')" class="text-slate-500 hover:text-slate-800">&times;</button>
            </div>
            <div class="flex-grow overflow-y-auto p-6">
                <!-- Modal Content Here -->
            </div>
        </div>
    </div>

    <!-- Repair Verification Modal -->
    <div id="verificationModal" class="fixed inset-0 modal-bg z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-5xl h-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-xl font-bold text-slate-800">수리 내역 AI 추출 결과 확인</h2>
                <button onclick="closeModal('verificationModal')" class="text-slate-500 hover:text-slate-800">&times;</button>
            </div>
            <div class="flex-grow overflow-y-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                 <div>
                    <h3 class="font-semibold text-slate-700 mb-2">원본 문서 미리보기</h3>
                    <div class="bg-slate-200 h-full min-h-[400px] rounded-md flex items-center justify-center">
                        <p class="text-slate-500">[업로드된 문서 이미지가 여기에 표시됩니다]</p>
                    </div>
                </div>
                <div>
                    <h3 class="font-semibold text-slate-700 mb-2">추출된 정보 (수정 가능)</h3>
                    <form id="verificationForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700">장비 S/N</label>
                            <input type="text" value="CM-GA-015" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700">수리 업체명</label>
                            <input type="text" value="정밀기기솔루션" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700">수리 일자</label>
                            <input type="date" value="2025-08-15" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm">
                        </div>
                        <div class="border-t pt-4">
                            <h4 class="font-medium text-slate-700 mb-2">교체 부품 및 비용</h4>
                            <div class="space-y-2">
                                <div class="flex gap-2 items-center">
                                    <input type="text" value="O2 센서 모듈" class="flex-grow p-2 border border-slate-300 rounded-md">
                                    <input type="number" value="350000" class="w-32 p-2 border border-slate-300 rounded-md">
                                </div>
                                <div class="flex gap-2 items-center">
                                    <input type="text" value="유량 펌프" class="flex-grow p-2 border border-slate-300 rounded-md">
                                    <input type="number" value="120000" class="w-32 p-2 border border-slate-300 rounded-md">
                                </div>
                            </div>
                        </div>
                         <div>
                            <label class="block text-sm font-medium text-slate-700">총 수리 비용</label>
                            <input type="number" value="470000" class="mt-1 block w-full p-2 border bg-slate-100 border-slate-300 rounded-md shadow-sm" readonly>
                        </div>
                    </form>
                </div>
            </div>
            <div class="p-4 border-t flex justify-end gap-3">
                <button onclick="closeModal('verificationModal')" class="bg-slate-200 text-slate-800 font-bold py-2 px-4 rounded-md hover:bg-slate-300">취소</button>
                <button onclick="saveRepairData()" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700">확정 및 저장</button>
            </div>
        </div>
    </div>
    
<script>
    // DOM이 완전히 로드된 후에 실행
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM 로드 완료, 함수들 초기화 시작');
        
        const mockData = {
            equipment: [
                // 청명장비 엑셀 데이터 기반 샘플
                { sn: '770654', category: 'MP-가스30KN', model: 'MP-가스30KN', status: '사용중', location: '서울 현장', uptime: 95 },
                { sn: '770655', category: 'MP-가스30KN', model: 'MP-가스30KN', status: '사용중', location: '부산 현장', uptime: 88 },
                { sn: '17-1733', category: 'SO2 Serinus50i', model: 'Serinus50i', status: '점검필요', location: '본사 창고', uptime: 72 },
                { sn: '17-1906', category: 'SO2 Serinus50i', model: 'Serinus50i', status: '수리중', location: '정밀기기솔루션', uptime: 0 },
                { sn: '1501478', category: 'PM-2.5 PMS-204', model: 'PMS-204', status: '사용중', location: '대구 현장', uptime: 92 },
                { sn: '1501479', category: 'PM-2.5 PMS-204', model: 'PMS-204', status: '대기중', location: '본사 창고', uptime: 0 },
                { sn: '19P404', category: 'PM-2.5 KMS-4200', model: 'KMS-4200', status: '사용중', location: '인천 현장', uptime: 89 },
                { sn: 'T25861', category: 'PM-2.5 E-BAM', model: 'E-BAM', status: '점검필요', location: '본사 창고', uptime: 65 },
                { sn: 'X22198', category: 'PM-2.5 BAM 1020', model: 'BAM 1020', status: '사용중', location: '광주 현장', uptime: 94 },
                { sn: '1904003', category: 'PM-10 PMS-204', model: 'PMS-204', status: '사용중', location: '울산 현장', uptime: 91 }
            ],
            // 회계 관련 데이터 추가
            purchaseRequests: [
                { id: 'PR-2025-001', itemName: 'MP-가스30KN 센서', department: '기술팀', requestor: '김기술', quantity: 2, estimatedPrice: 1500000, reason: '서울 현장 장비 센서 교체 필요', status: 'approved', date: '2025-01-15' },
                { id: 'PR-2025-002', itemName: 'SO2 Serinus50i 부품', department: '정비팀', requestor: '박정비', quantity: 1, estimatedPrice: 800000, reason: '부산 현장 장비 부품 교체', status: 'submitted', date: '2025-01-18' },
                { id: 'PR-2025-003', itemName: 'PM-2.5 PMS-204 모듈', department: '운영팀', requestor: '이운영', quantity: 3, estimatedPrice: 1200000, reason: '대구 현장 장비 모듈 업그레이드', status: 'draft', date: '2025-01-20' }
            ],
            quotations: [
                { id: 'QT-2025-001', requestId: 'PR-2025-001', itemName: 'MP-가스30KN 센서', supplier: '정밀기기솔루션', quantity: 2, unitPrice: 1450000, deliveryDate: '2025-02-15', status: 'issued', date: '2025-01-16' },
                { id: 'QT-2025-002', requestId: 'PR-2025-002', itemName: 'SO2 Serinus50i 부품', supplier: '기기수리센터', quantity: 1, unitPrice: 780000, deliveryDate: '2025-02-10', status: 'draft', date: '2025-01-19' },
                { id: 'QT-2025-003', requestId: 'PR-2025-003', itemName: 'PM-2.5 PMS-204 모듈', supplier: '환경측정기기', quantity: 3, unitPrice: 1150000, deliveryDate: '2025-02-20', status: 'draft', date: '2025-01-21' }
            ],
            transactionSpecs: [
                { id: 'TS-2025-001', quoteId: 'QT-2025-001', itemName: 'MP-가스30KN 센서', supplier: '정밀기기솔루션', quantity: 2, totalAmount: 3190000, deliveryDate: '2025-02-15', status: 'completed', date: '2025-01-22' }
            ],
            alarms: [
                { time: '2025-01-20 14:30:15', type: '정도검사 임박', sn: '17-1733', message: 'SO2 Serinus50i 정도검사 예정일이 7일 이내입니다.', priority: '높음', status: '미확인' },
                { time: '2025-01-20 14:25:30', type: '장기간 입고', sn: '1501479', message: 'PM-2.5 PMS-204가 30일 이상 본사 창고에 입고되어 있습니다.', priority: '보통', status: '미확인' },
                { time: '2025-01-20 14:20:15', type: '가동 저하', sn: 'T25861', message: 'PM-2.5 E-BAM 가동률이 70% 이하로 저하되었습니다.', priority: '높음', status: '확인됨' },
                { time: '2025-01-20 14:15:45', type: '입고 내역', sn: '17-1906', message: 'SO2 Serinus50i가 정밀기기솔루션에 입고되었습니다.', priority: '낮음', status: '처리중' },
                { time: '2025-01-20 14:10:20', type: '결제 생성', sn: 'N/A', message: '새로운 수리 결제가 생성되었습니다.', priority: '보통', status: '미확인' }
            ],
            repairHistory: {
                '17-1906': [
                    { date: '2025-01-20', company: '정밀기기솔루션', details: 'SO2 센서 교체, 보정 작업', cost: 850000 },
                    { date: '2024-08-15', company: '기기수리센터', details: '전원부 회로 수리', cost: 320000 },
                ],
                'T25861': [
                    { date: '2024-12-10', company: '정밀기기솔루션', details: '유량 센서 교체', cost: 450000 },
                ]
            },
            movementHistory: {
                '17-1906': [
                    { date: '2025-01-20', type: '입고', location: '정밀기기솔루션' },
                    { date: '2025-01-15', type: '출고', location: '서울 현장' },
                ],
                '1501479': [
                    { date: '2024-12-20', type: '입고', location: '본사 창고' },
                    { date: '2024-12-15', type: '출고', location: '대구 현장' },
                ]
            }
        };

        let repairFrequencyChart, costTrendChart;

        function initDashboardCharts() {
            const repairCtx = document.getElementById('repairFrequencyChart').getContext('2d');
            if (repairFrequencyChart) repairFrequencyChart.destroy();
            repairFrequencyChart = new Chart(repairCtx, {
                type: 'bar',
                data: {
                    labels: ['가스 분석기', '유량 측정기', '압력 센서', '기타'],
                    datasets: [{
                        label: '수리 건수',
                        data: [12, 8, 5, 3],
                        backgroundColor: 'rgba(79, 70, 229, 0.8)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } }
                }
            });

            const costCtx = document.getElementById('costTrendChart').getContext('2d');
            if (costTrendChart) costTrendChart.destroy();
            costTrendChart = new Chart(costCtx, {
                type: 'line',
                data: {
                    labels: ['3월', '4월', '5월', '6월', '7월', '8월'],
                    datasets: [{
                        label: '수리 비용 (만원)',
                        data: [120, 150, 90, 180, 130, 210],
                        fill: false,
                        borderColor: 'rgb(13, 148, 136)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        // 전역 노출: 장비 테이블 렌더링
        window.renderEquipmentTable = function(filteredData) {
            const tableBody = document.getElementById('equipmentTableBody');
            tableBody.innerHTML = '';
            const dataToRender = filteredData || mockData.equipment;
            
            if (dataToRender.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="6" class="text-center p-4 text-slate-500">검색 결과가 없습니다.</td></tr>`;
                return;
            }

            dataToRender.forEach(item => {
                let statusColor = 'bg-slate-100 text-slate-800';
                if (item.status === '사용중') statusColor = 'bg-green-100 text-green-800';
                if (item.status === '수리중') statusColor = 'bg-yellow-100 text-yellow-800';
                if (item.status === '점검필요') statusColor = 'bg-red-100 text-red-800';

                const row = `
                    <tr class="border-b hover:bg-slate-50">
                        <td class="p-4 font-medium text-slate-900">${item.sn}</td>
                        <td class="p-4 text-slate-600 hidden md:table-cell">${item.category}</td>
                        <td class="p-4 text-slate-600">${item.model}</td>
                        <td class="p-4 text-slate-600"><span class="px-2 py-1 text-xs font-medium rounded-full ${statusColor}">${item.status}</span></td>
                        <td class="p-4 text-slate-600 hidden sm:table-cell">${item.location}</td>
                        <td class="p-4 text-slate-600">
                            <div class="flex items-center">
                                <div class="w-16 bg-slate-200 rounded-full h-2 mr-2">
                                    <div class="bg-indigo-600 h-2 rounded-full" style="width: ${item.uptime || 0}%"></div>
                                </div>
                                <span class="text-sm">${item.uptime || 0}%</span>
                            </div>
                        </td>
                        <td class="p-4 text-slate-600">
                            <div class="flex gap-1">
                                <button onclick="controlEquipment('${item.sn}', 'start')" class="px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700">시작</button>
                                <button onclick="controlEquipment('${item.sn}', 'stop')" class="px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700">정지</button>
                                <button onclick="controlEquipment('${item.sn}', 'open')" class="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">열림</button>
                                <button onclick="controlEquipment('${item.sn}', 'close')" class="px-2 py-1 text-xs bg-yellow-600 text-white rounded hover:bg-yellow-700">닫힘</button>
                            </div>
                        </td>
                        <td class="p-4 text-right">
                            <button onclick="showDetail('${item.sn}')" class="text-indigo-600 hover:text-indigo-900 font-semibold">상세보기</button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        };





        // 알람 관련 함수들
        window.renderAlarmsTable = function() {
            const tableBody = document.getElementById('alarmsTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            mockData.alarms.forEach((alarm, index) => {
                let priorityColor = 'bg-slate-100 text-slate-800';
                if (alarm.priority === '높음') priorityColor = 'bg-red-100 text-red-800';
                if (alarm.priority === '보통') priorityColor = 'bg-yellow-100 text-yellow-800';
                if (alarm.priority === '낮음') priorityColor = 'bg-green-100 text-green-800';

                let statusColor = 'bg-slate-100 text-slate-800';
                if (alarm.status === '미확인') statusColor = 'bg-red-100 text-red-800';
                if (alarm.status === '확인됨') statusColor = 'bg-green-100 text-green-800';
                if (alarm.status === '처리중') statusColor = 'bg-yellow-100 text-yellow-800';

                const row = `
                    <tr class="border-b hover:bg-slate-50">
                        <td class="p-4 text-slate-600">${alarm.time}</td>
                        <td class="p-4 text-slate-600">${alarm.type}</td>
                        <td class="p-4 font-medium text-slate-900">${alarm.sn}</td>
                        <td class="p-4 text-slate-600">${alarm.message}</td>
                        <td class="p-4"><span class="px-2 py-1 text-xs font-medium rounded-full ${priorityColor}">${alarm.priority}</span></td>
                        <td class="p-4"><span class="px-2 py-1 text-xs font-medium rounded-full ${statusColor}">${alarm.status}</span></td>
                        <td class="p-4 text-right">
                            <button onclick="acknowledgeAlarm(${index})" class="text-indigo-600 hover:text-indigo-900 font-semibold mr-2">확인</button>
                            <button onclick="processAlarm(${index})" class="text-green-600 hover:text-green-900 font-semibold">처리</button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        };

        window.acknowledgeAlarm = function(index) {
            mockData.alarms[index].status = '확인됨';
            window.renderAlarmsTable();
        };

        window.processAlarm = function(index) {
            mockData.alarms[index].status = '처리중';
            window.renderAlarmsTable();
        };

        window.acknowledgeAllAlarms = function() {
            mockData.alarms.forEach(alarm => {
                if (alarm.status === '미확인') {
                    alarm.status = '확인됨';
                }
            });
            window.renderAlarmsTable();
        };

        // 제어 패널 관련 함수들
        window.sendCommand = function(command) {
            const equipment = document.getElementById('control-equipment').value;
            if (!equipment) {
                alert('장비를 선택해주세요.');
                return;
            }

            const commandLog = document.getElementById('commandLog');
            const timestamp = new Date().toLocaleString('ko-KR');
            const commandText = `${timestamp} - ${equipment} ${command} 명령 전송됨`;
            
            commandLog.innerHTML = `<div>${commandText}</div>` + commandLog.innerHTML;
            
            // 명령 전송 시뮬레이션
            setTimeout(() => {
                const responseText = `${timestamp} - ${equipment} ${command} 명령 실행 완료`;
                commandLog.innerHTML = `<div class="text-green-600">${responseText}</div>` + commandLog.innerHTML;
            }, 1000);
        };

        window.addSchedule = function() {
            const equipment = document.getElementById('schedule-equipment').value;
            const time = document.getElementById('schedule-time').value;
            const command = document.getElementById('schedule-command').value;
            
            if (!equipment || !time || !command) {
                alert('모든 필드를 입력해주세요.');
                return;
            }

            const scheduleList = document.getElementById('scheduleList');
            const scheduleItem = document.createElement('div');
            scheduleItem.className = 'flex justify-between items-center p-2 bg-slate-50 rounded';
            scheduleItem.innerHTML = `
                <span class="text-sm">${equipment} - ${time} ${command}</span>
                <button onclick="this.parentElement.remove()" class="text-red-600 hover:text-red-800">삭제</button>
            `;
            scheduleList.appendChild(scheduleItem);

            // 입력 필드 초기화
            document.getElementById('schedule-equipment').value = '';
            document.getElementById('schedule-time').value = '';
            document.getElementById('schedule-command').value = '';
        };

        window.removeSchedule = function(index) {
            const scheduleList = document.getElementById('scheduleList');
            const items = scheduleList.children;
            if (items[index]) {
                items[index].remove();
            }
        };
        // 장비 제어 함수 (상세 테이블 버튼용)
        window.controlEquipment = function(sn, action) {
            const equipment = mockData.equipment.find(e => e.sn === sn);
            if (!equipment) return;
            let message = '';
            switch (action) {
                case 'start':
                    message = `${sn} 장비를 시작합니다.`;
                    equipment.status = '사용중';
                    equipment.uptime = Math.min(100, (equipment.uptime || 0) + 10);
                    break;
                case 'stop':
                    message = `${sn} 장비를 정지합니다.`;
                    equipment.status = '대기중';
                    equipment.uptime = Math.max(0, (equipment.uptime || 0) - 10);
                    break;
                case 'open':
                    message = `${sn} 장비를 열기 상태로 전환합니다.`;
                    break;
                case 'close':
                    message = `${sn} 장비를 닫기 상태로 전환합니다.`;
                    break;
            }
            alert(message);
            window.renderEquipmentTable();
        };

        // 초기 렌더 초기화
            initDashboardCharts();
            window.renderEquipmentTable();

            // 물품구매요구서 양식 초기화
            const tableBody = document.getElementById('item-details-table');
            if (tableBody) {
                for (let i = 0; i < 12; i++) {
                    addItemRow();
                }
            }

            const searchInput = document.getElementById('searchInput');
            const categoryFilter = document.getElementById('categoryFilter');

            function filterData() {
                const searchTerm = searchInput.value.toLowerCase();
                const category = categoryFilter.value;
                const filtered = mockData.equipment.filter(item => {
                    const matchesSearch = item.sn.toLowerCase().includes(searchTerm) || item.model.toLowerCase().includes(searchTerm);
                    const matchesCategory = category === 'all' || item.category === category;
                    return matchesSearch && matchesCategory;
                });
                renderEquipmentTable(filtered);
            }

            searchInput.addEventListener('input', filterData);
            categoryFilter.addEventListener('change', filterData);
            
            // 알림 필터 이벤트 리스너 추가
            const alarmPriorityFilter = document.getElementById('alarm-priority-filter');
            const alarmTypeFilter = document.getElementById('alarm-type-filter');
            const accountingAlarmTypeFilter = document.getElementById('accounting-alarm-type-filter');
            
            if (alarmPriorityFilter) {
                alarmPriorityFilter.addEventListener('change', renderEquipmentAlarmTable);
            }
            if (alarmTypeFilter) {
                alarmTypeFilter.addEventListener('change', renderEquipmentAlarmTable);
            }
            if (accountingAlarmTypeFilter) {
                accountingAlarmTypeFilter.addEventListener('change', renderAccountingAlarmTable);
            }
            
            const dropzone = document.getElementById('dropzone');
            const fileUpload = document.getElementById('fileUpload');
            const uploadProgress = document.getElementById('upload-progress');
            const progressBar = uploadProgress.querySelector('div');

            dropzone.addEventListener('click', () => fileUpload.click());
            dropzone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropzone.classList.add('border-indigo-500', 'bg-indigo-50');
            });
            dropzone.addEventListener('dragleave', () => {
                dropzone.classList.remove('border-indigo-500', 'bg-indigo-50');
            });
            dropzone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropzone.classList.remove('border-indigo-500', 'bg-indigo-50');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            });
            fileUpload.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
            
            // Excel import (청명장비 엑셀 활용)
            const excelBtn = document.getElementById('excelImportBtn');
            const excelFile = document.getElementById('excelFile');
            excelBtn?.addEventListener('click', () => excelFile.click());
            excelFile?.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                try {
                    await importFromExcel(file);
                    renderEquipmentTable();
                    updateKpis();
                    alert('엑셀 데이터를 불러왔습니다.');
                } catch (err) {
                    console.error(err);
                    alert('엑셀 파싱 중 오류가 발생했습니다. 파일 형식을 확인해주세요.');
                } finally {
                    e.target.value = '';
                }
            });
            
            function handleFileUpload(file) {
                uploadProgress.classList.remove('hidden');
                progressBar.style.width = '0%';
                
                let width = 0;
                const interval = setInterval(() => {
                    width += 10;
                    progressBar.style.width = width + '%';
                    if (width >= 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            uploadProgress.classList.add('hidden');
                            document.getElementById('verificationModal').classList.remove('hidden');
                            document.getElementById('verificationModal').classList.add('flex');
                        }, 500);
                    }
                }, 150);
            }
            
            // 초기 KPI 반영 및 대시보드 표시
            updateKpis();
            
            // 대시보드를 기본 뷰로 표시
            document.getElementById('dashboard-view').classList.remove('hidden');
            
            // 알림 테이블 초기화
            renderEquipmentAlarmTable();
            renderAccountingAlarmTable();
            
            // 장비 현황 탭 초기 로드
            if (document.getElementById('equipment-status')) {
                console.log('장비 현황 탭 초기 로드 시작');
                loadEquipmentStatus();
            } else {
                console.log('equipment-status 요소를 찾을 수 없습니다.');
            }
            
            // 첫 번째 장비 탭 버튼을 기본적으로 활성화
            const firstEquipmentTab = document.querySelector('.equipment-tab:first-child');
            if (firstEquipmentTab) {
                firstEquipmentTab.classList.add('active', 'border-indigo-500', 'text-indigo-600');
                firstEquipmentTab.classList.remove('text-slate-500');
            }
        

        // 알림 관련 테스트 데이터
        const mockAlarmData = {
            equipmentAlarms: [
                {
                    id: 1,
                    time: '2024-01-15 16:30:00',
                    serialNumber: '770654',
                    model: '(PM-10) MP-30KN',
                    content: '장기간 입고 - 창고 보관 45일 경과',
                    priority: 'high',
                    status: 'unread',
                    alarmType: 'long-term-storage'
                },
                {
                    id: 2,
                    time: '2024-01-15 16:15:00',
                    serialNumber: '17-1733',
                    model: '(SO2) Serinus50i',
                    content: '예상치 여유분 초과 - 재고량 150% 초과',
                    priority: 'medium',
                    status: 'unread',
                    alarmType: 'excess-inventory'
                },
                {
                    id: 3,
                    time: '2024-01-15 16:00:00',
                    serialNumber: '1501478',
                    model: '(PM-2.5) PMS-204',
                    content: '이카운트 복귀 미입력 - 현장 반납 후 7일 경과',
                    priority: 'high',
                    status: 'unread',
                    alarmType: 'return-not-recorded'
                },
                {
                    id: 4,
                    time: '2024-01-15 15:45:00',
                    serialNumber: '19P404',
                    model: '(PM-2.5) KMS-4200',
                    content: '정도검사 임박 - 검사 예정일 3일 전',
                    priority: 'medium',
                    status: 'unread',
                    alarmType: 'inspection-due'
                },
                {
                    id: 5,
                    time: '2024-01-15 15:30:00',
                    serialNumber: 'T25861',
                    model: '(PM-2.5) E-BAM',
                    content: '가동률 미달 - 월 가동률 65% (목표 85%)',
                    priority: 'high',
                    status: 'unread',
                    alarmType: 'low-uptime'
                },
                {
                    id: 6,
                    time: '2024-01-15 15:15:00',
                    serialNumber: '770655',
                    model: '(PM-10) MP-30KN',
                    content: '장기간 입고 - 창고 보관 38일 경과',
                    priority: 'medium',
                    status: 'unread',
                    alarmType: 'long-term-storage'
                },
                {
                    id: 7,
                    time: '2024-01-15 15:00:00',
                    serialNumber: '17-1906',
                    model: '(SO2) Serinus50i',
                    content: '예상치 여유분 초과 - 재고량 120% 초과',
                    priority: 'low',
                    status: 'unread',
                    alarmType: 'excess-inventory'
                },
                {
                    id: 8,
                    time: '2024-01-15 14:45:00',
                    serialNumber: '1501481',
                    model: '(PM-2.5) PMS-204',
                    content: '이카운트 복귀 미입력 - 현장 반납 후 5일 경과',
                    priority: 'medium',
                    status: 'unread',
                    alarmType: 'return-not-recorded'
                },
                {
                    id: 9,
                    time: '2024-01-15 14:30:00',
                    serialNumber: '20P556',
                    model: '(PM-2.5) KMS-4200',
                    content: '정도검사 임박 - 검사 예정일 5일 전',
                    priority: 'low',
                    status: 'unread',
                    alarmType: 'inspection-due'
                },
                {
                    id: 10,
                    time: '2024-01-15 14:15:00',
                    serialNumber: 'W17343',
                    model: '(PM-2.5) E-BAM',
                    content: '가동률 미달 - 월 가동률 72% (목표 85%)',
                    priority: 'medium',
                    status: 'unread',
                    alarmType: 'low-uptime'
                }
            ],
            accountingAlarms: [
                {
                    id: 1,
                    time: '2024-01-15 17:00:00',
                    type: 'document',
                    content: '입고 내역 알림 - 거래명세서 발행 필요 (770654, 770655)',
                    amount: '3,200,000원',
                    status: 'pending',
                    alarmType: 'invoice-required'
                },
                {
                    id: 2,
                    time: '2024-01-15 16:45:00',
                    type: 'deadline',
                    content: '납기 예상기간 초과 - PMS-204 배송 지연 3일',
                    amount: '2,800,000원',
                    status: 'warning',
                    alarmType: 'delivery-delayed'
                },
                {
                    id: 3,
                    time: '2024-01-15 16:30:00',
                    type: 'approval',
                    content: '결재 상신 2주 경과 - KMS-4200 구매 승인 대기',
                    amount: '5,500,000원',
                    status: 'pending',
                    alarmType: 'approval-delayed'
                },
                {
                    id: 4,
                    time: '2024-01-15 16:15:00',
                    type: 'document',
                    content: '입고 내역 알림 - 거래명세서 발행 필요 (17-1733, 17-1906)',
                    amount: '4,100,000원',
                    status: 'pending',
                    alarmType: 'invoice-required'
                },
                {
                    id: 5,
                    time: '2024-01-15 16:00:00',
                    type: 'deadline',
                    content: '납기 예상기간 초과 - E-BAM 배송 지연 2일',
                    amount: '1,900,000원',
                    status: 'warning',
                    alarmType: 'delivery-delayed'
                },
                {
                    id: 6,
                    time: '2024-01-15 15:45:00',
                    type: 'approval',
                    content: '결재 상신 2주 경과 - PMS-204 수리비용 승인 대기',
                    amount: '850,000원',
                    status: 'pending',
                    alarmType: 'approval-delayed'
                },
                {
                    id: 7,
                    time: '2024-01-15 15:30:00',
                    type: 'document',
                    content: '입고 내역 알림 - 거래명세서 발행 필요 (1501478, 1501481)',
                    amount: '3,600,000원',
                    status: 'pending',
                    alarmType: 'invoice-required'
                },
                {
                    id: 8,
                    time: '2024-01-15 15:15:00',
                    type: 'deadline',
                    content: '납기 예상기간 초과 - Serinus50i 배송 지연 4일',
                    amount: '6,200,000원',
                    status: 'warning',
                    alarmType: 'delivery-delayed'
                },
                {
                    id: 9,
                    time: '2024-01-15 15:00:00',
                    type: 'approval',
                    content: '결재 상신 2주 경과 - MP-30KN 구매 승인 대기',
                    amount: '8,900,000원',
                    status: 'pending',
                    alarmType: 'approval-delayed'
                },
                {
                    id: 10,
                    time: '2024-01-15 14:45:00',
                    type: 'document',
                    content: '입고 내역 알림 - 거래명세서 발행 필요 (19P404, 20P556)',
                    amount: '2,700,000원',
                    status: 'pending',
                    alarmType: 'invoice-required'
                }
            ]
        };

        // Excel -> mockData.equipment 파싱
        async function importFromExcel(file) {
            const arrayBuffer = await file.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            // 첫 시트를 기준으로 파싱
            const firstSheetName = workbook.SheetNames[0];
            const sheet = workbook.Sheets[firstSheetName];
            const rows = XLSX.utils.sheet_to_json(sheet, { defval: '' });
            // 컬럼 매핑 추정: S/N, 품목계열, 모델명, 상태, 위치
            const mapped = rows.map(r => ({
                sn: r['S/N'] || r['SN'] || r['시리얼'] || r['Serial'] || String(r['sn'] || r['Sn'] || r['S_N'] || '').trim(),
                category: r['품목계열'] || r['품목 계열'] || r['계열'] || r['Category'] || '기타',
                model: r['모델명'] || r['Model'] || r['model'] || '-',
                status: r['상태'] || r['Status'] || '대기중',
                location: r['위치'] || r['현장'] || r['Location'] || '본사 창고',
            })).filter(x => x.sn);
            if (mapped.length === 0) throw new Error('엑셀에서 유효한 S/N 열을 찾지 못했습니다.');
            mockData.equipment = mapped;
        }

        // 장비 알림 테이블 렌더링
        window.renderEquipmentAlarmTable = function() {
            const tbody = document.getElementById('equipment-alarm-table');
            if (!tbody) return;
            
            const priorityFilter = document.getElementById('alarm-priority-filter')?.value || 'all';
            const typeFilter = document.getElementById('alarm-type-filter')?.value || 'all';
            let filteredAlarms = mockAlarmData.equipmentAlarms;
            
            if (priorityFilter !== 'all') {
                filteredAlarms = filteredAlarms.filter(alarm => alarm.priority === priorityFilter);
            }
            
            if (typeFilter !== 'all') {
                filteredAlarms = filteredAlarms.filter(alarm => alarm.alarmType === typeFilter);
            }
            
            tbody.innerHTML = filteredAlarms.map(alarm => `
                <tr class="hover:bg-slate-50 ${alarm.status === 'unread' ? 'bg-blue-50' : ''}">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">${alarm.time}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900 font-medium">${alarm.serialNumber}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">${alarm.model}</td>
                    <td class="px-6 py-4 text-sm text-slate-900">${alarm.content}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                            alarm.priority === 'high' ? 'bg-red-100 text-red-800' :
                            alarm.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-green-100 text-green-800'
                        }">
                            ${alarm.priority === 'high' ? '높음' : alarm.priority === 'medium' ? '보통' : '낮음'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                            alarm.status === 'unread' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'
                        }">
                            ${alarm.status === 'unread' ? '미확인' : '확인됨'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
                        ${alarm.status === 'unread' ? 
                            `<button onclick="acknowledgeEquipmentAlarm(${alarm.id})" class="text-indigo-600 hover:text-indigo-900">확인</button>` :
                            '확인됨'
                        }
                    </td>
                </tr>
            `).join('');
        };

        // 회계 알림 테이블 렌더링
        window.renderAccountingAlarmTable = function() {
            const tbody = document.getElementById('accounting-alarm-table');
            if (!tbody) return;
            
            const typeFilter = document.getElementById('accounting-alarm-type-filter')?.value || 'all';
            let filteredAlarms = mockAlarmData.accountingAlarms;
            
            if (typeFilter !== 'all') {
                filteredAlarms = filteredAlarms.filter(alarm => alarm.type === typeFilter);
            }
            
            tbody.innerHTML = filteredAlarms.map(alarm => `
                <tr class="hover:bg-slate-50 ${alarm.status === 'pending' ? 'bg-yellow-50' : ''}">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">${alarm.time}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                            alarm.type === 'document' ? 'bg-blue-100 text-blue-800' :
                            alarm.type === 'deadline' ? 'bg-orange-100 text-orange-800' :
                            'bg-purple-100 text-purple-800'
                        }">
                            ${alarm.type === 'document' ? '거래명세서 발행' : alarm.type === 'deadline' ? '납기 지연' : '결재 지연'}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-slate-900">${alarm.content}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900 font-medium">${alarm.amount}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                            alarm.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                            alarm.status === 'warning' ? 'bg-red-100 text-red-800' :
                            'bg-blue-100 text-blue-800'
                        }">
                            ${alarm.status === 'pending' ? '대기중' : alarm.status === 'warning' ? '경고' : '정보'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
                        ${alarm.status === 'pending' ? 
                            `<button onclick="acknowledgeAccountingAlarm(${alarm.id})" class="text-indigo-600 hover:text-indigo-900">확인</button>` :
                            '처리됨'
                        }
                    </td>
                </tr>
            `).join('');
        };

        // 장비 알림 확인 처리
        function acknowledgeEquipmentAlarm(alarmId) {
            const alarm = mockAlarmData.equipmentAlarms.find(a => a.id === alarmId);
            if (alarm) {
                alarm.status = 'read';
                renderEquipmentAlarmTable();
            }
        }

        // 회계 알림 확인 처리
        function acknowledgeAccountingAlarm(alarmId) {
            const alarm = mockAlarmData.accountingAlarms.find(a => a.id === alarmId);
            if (alarm) {
                alarm.status = 'processed';
                renderAccountingAlarmTable();
            }
        }

        // 전체 장비 알림 확인
        function acknowledgeAllEquipmentAlarms() {
            mockAlarmData.equipmentAlarms.forEach(alarm => {
                alarm.status = 'read';
            });
            renderEquipmentAlarmTable();
        }

        // 전체 회계 알림 확인
        function acknowledgeAllAccountingAlarms() {
            mockAlarmData.accountingAlarms.forEach(alarm => {
                if (alarm.status === 'pending') {
                    alarm.status = 'processed';
                }
            });
            renderAccountingAlarmTable();
        }

        // 서브메뉴 토글 기능 (전역 노출)
        window.toggleSubmenu = function(menuId) {
            const menu = document.getElementById(menuId);
            const toggle = menu.previousElementSibling.querySelector('.submenu-toggle');
            
            if (menu.classList.contains('hidden')) {
                // 다른 모든 서브메뉴 닫기
                document.querySelectorAll('.submenu').forEach(submenu => {
                    if (submenu.id !== menuId) {
                        submenu.classList.add('hidden');
                        const otherToggle = submenu.previousElementSibling.querySelector('.submenu-toggle');
                        if (otherToggle) otherToggle.classList.remove('rotated');
                    }
                });
                
                // 현재 서브메뉴 열기
                menu.classList.remove('hidden');
                if (toggle) toggle.classList.add('rotated');
            } else {
                // 현재 서브메뉴 닫기
                menu.classList.add('hidden');
                if (toggle) toggle.classList.remove('rotated');
            }
        };

        // KPI 업데이트: 총 장비/가동률/수리건수(더미)/고장예측(더미)
        function updateKpis() {
            // 실제 총장비 수 (serials.csv 기준)
            const total = 295;
            
            // 품목계열별 가동률 (50-90% 랜덤)
            const productCategories = ['(PM-2.5)', '(PM-10)', '(NO2)', '(SO2)', '(CO)', '(O3)', '(NOx, SOx)'];
            const uptime = Math.floor(Math.random() * 41) + 50; // 50-90% 랜덤
            
            // 월간 수리 건수 (고정값)
            const repairCount = 8;
            
            // 고장 예측 (고정값)
            const predict = 3;
            
            const el = (id) => document.getElementById(id);
            if (el('kpi-total')) el('kpi-total').textContent = `${total} 대`;
            if (el('kpi-uptime')) el('kpi-uptime').textContent = `${uptime}%`;
            if (el('kpi-repairs')) el('kpi-repairs').textContent = `${repairCount} 건`;
            if (el('kpi-predict')) el('kpi-predict').textContent = `${predict} 건`;
        }

        // 회계 관련 함수들 (사용하지 않는 함수들 제거)

        // 물품구매요구서 관련 함수들
        // 물품구매요구서 관련 함수들 (새로운 양식용)
        function submitForApproval() {
            alert('물품구매요구서가 결재 상신되었습니다.');
        }

        // 견적서 관련 함수들
        function loadDBFromRequest() {
            const selectedRequest = document.getElementById('approved-request-select').value;
            if (!selectedRequest) {
                alert('구매요구서를 선택해주세요.');
                return;
            }

            const request = mockData.purchaseRequests.find(req => req.id === selectedRequest);
            if (!request) return;

            // 견적서 폼에 데이터 채우기
            document.getElementById('quote-item-name').value = request.itemName;
            document.getElementById('quote-quantity').value = request.quantity;
            
            // 금액 계산
            calculateQuoteAmount();
            
            alert('DB 데이터가 성공적으로 가져와졌습니다.');
        }

        function calculateQuoteAmount() {
            const quantity = parseInt(document.getElementById('quote-quantity').value) || 0;
            const unitPrice = parseInt(document.getElementById('unit-price').value) || 0;
            
            const supplyAmount = quantity * unitPrice;
            const vatAmount = Math.round(supplyAmount * 0.1); // 10% 부가세
            const totalAmount = supplyAmount + vatAmount;
            
            document.getElementById('supply-amount').value = supplyAmount.toLocaleString() + '원';
            document.getElementById('vat-amount').value = vatAmount.toLocaleString() + '원';
            document.getElementById('total-amount').value = totalAmount.toLocaleString() + '원';
        }

        function saveQuotation() {
            const supplier = document.getElementById('supplier').value;
            const unitPrice = document.getElementById('unit-price').value;
            
            if (!supplier || !unitPrice) {
                alert('공급업체와 단가를 입력해주세요.');
                return;
            }

            // 견적서 저장 로직
            alert('견적서가 저장되었습니다.');
        }

        function issueQuotation() {
            const supplier = document.getElementById('supplier').value;
            if (!supplier) {
                alert('공급업체를 선택해주세요.');
                return;
            }

            alert('견적서가 발행되었습니다.');
        }

        // 거래명세서 관련 함수들
        function uploadInventory() {
            const file = document.getElementById('inventory-upload').files[0];
            const date = document.getElementById('inventory-date').value;
            const location = document.getElementById('inventory-location').value;
            
            if (!file || !date || !location) {
                alert('모든 필드를 입력해주세요.');
                return;
            }

            alert('입고내역이 성공적으로 업로드되었습니다.');
        }

        function loadQuoteData() {
            const selectedQuote = document.getElementById('quote-select').value;
            if (!selectedQuote) {
                alert('견적서를 선택해주세요.');
                return;
            }

            alert('견적서 데이터가 성공적으로 가져와졌습니다.');
        }

        function printTransactionSpec() {
            const format = document.getElementById('print-format').value;
            alert(`거래명세서가 ${format.toUpperCase()} 형식으로 출력되었습니다.`);
        }

        function downloadTransactionSpec() {
            const format = document.getElementById('print-format').value;
            alert(`거래명세서가 ${format.toUpperCase()} 형식으로 다운로드되었습니다.`);
        }

        function sendNotification() {
            const recipient = document.getElementById('notification-recipient').value;
            const content = document.getElementById('notification-content').value;
            
            if (!content) {
                alert('알림 내용을 입력해주세요.');
                return;
            }

            alert(`${recipient}에게 알림이 전송되었습니다.`);
        }

        function scheduleNotification() {
            const recipient = document.getElementById('notification-recipient').value;
            const content = document.getElementById('notification-content').value;
            
            if (!content) {
                alert('알림 내용을 입력해주세요.');
                return;
            }

            alert(`${recipient}에게 알림이 예약 전송되었습니다.`);
        }

        // 새로운 물품구매요구서 양식 관련 함수들
        function addItemRow() {
            const tableBody = document.getElementById('item-details-table');
            if (!tableBody) return;

            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td class="border border-slate-300 px-3 py-2">
                    <input type="text" class="w-full px-2 py-1 border border-slate-200 rounded text-sm" 
                           placeholder="품명을 입력하세요" onchange="calculateTotal()">
                </td>
                <td class="border border-slate-300 px-3 py-2">
                    <input type="text" class="w-full px-2 py-2 border border-slate-200 rounded text-sm" 
                           placeholder="규격을 입력하세요">
                </td>
                <td class="border border-slate-300 px-3 py-2">
                    <input type="number" class="w-full px-2 py-1 border border-slate-200 rounded text-sm" 
                           min="1" value="1" onchange="calculateTotal()">
                </td>
                <td class="border border-slate-300 px-3 py-2">
                    <input type="number" class="w-full px-2 py-1 border border-slate-200 rounded text-sm" 
                           placeholder="금액을 입력하세요" onchange="calculateTotal()">
                </td>
                <td class="border border-slate-300 px-3 py-2">
                    <input type="text" class="w-full px-2 py-1 border border-slate-200 rounded text-sm" 
                           placeholder="공급업체를 입력하세요">
                </td>
                <td class="border border-slate-300 px-3 py-2">
                    <input type="text" class="w-full px-2 py-1 border border-slate-200 rounded text-sm" 
                           placeholder="기타 사항을 입력하세요">
                </td>
            `;
            tableBody.appendChild(newRow);
        }

        function calculateTotal() {
            const rows = document.querySelectorAll('#item-details-table tr');
            let total = 0;

            rows.forEach(row => {
                const quantityInput = row.querySelector('td:nth-child(3) input');
                const priceInput = row.querySelector('td:nth-child(4) input');
                
                if (quantityInput && priceInput) {
                    const quantity = parseInt(quantityInput.value) || 0;
                    const price = parseInt(priceInput.value) || 0;
                    total += quantity * price;
                }
            });

            const vat = Math.round(total * 0.1); // 10% 부가세
            const grandTotal = total + vat;

            document.getElementById('total-amount').value = `₩${total.toLocaleString()}`;
            document.getElementById('vat-amount').value = `₩${vat.toLocaleString()}`;
            document.getElementById('grand-total').value = `₩${grandTotal.toLocaleString()}`;
        }

        // 장비 관리 관련 함수들
        function loadEquipmentStatus() {
            console.log('loadEquipmentStatus 함수 실행됨');
            
            // 먼저 더미 데이터로 즉시 표시
            const demoData = [
                { name: '(PM-10) MP-가30KN가', serial: '770654', location: '본사 실험실 A동', status: '가동 중' },
                { name: '(PM-10) MP-가30KN가', serial: '770655', location: '현장 A - 측정소', status: '가동 중' },
                { name: '(PM-10) MP-가30KN가', serial: '770658', location: '현장 B - 공장', status: '수리 중' },
                { name: '(PM-10) MP-가30KN가', serial: '770660', location: '본사 창고', status: '대기 중' },
                { name: '(SO2) Serinus50i', serial: '17-1733', location: '현장 C - 발전소', status: '가동 중' },
                { name: '(SO2) Serinus50i', serial: '17-1906', location: '현장 D - 정유소', status: '가동 중' },
                { name: '(SO2) Serinus50i', serial: '17-1912', location: '본사 실험실 B동', status: '점검 중' },
                { name: '(PM-2.5) PMS-204', serial: '1501478', location: '현장 E - 도시', status: '가동 중' },
                { name: '(PM-2.5) PMS-204', serial: '1501479', location: '현장 F - 산업단지', status: '가동 중' },
                { name: '(PM-2.5) PMS-204', serial: '1501481', location: '본사 창고', status: '대기 중' },
                { name: '(PM-2.5) KMS-4200', serial: '19P404', location: '현장 G - 항만', status: '가동 중' },
                { name: '(PM-2.5) KMS-4200', serial: '20P556', location: '현장 H - 공항', status: '가동 중' },
                { name: '(PM-2.5) E-BAM', serial: 'T25861', location: '본사 실험실 C동', status: '점검 중' },
                { name: '(PM-2.5) E-BAM', serial: 'T25864', location: '현장 I - 도로변', status: '가동 중' },
                { name: '(PM-10) PMS-204', serial: '1904003', location: '현장 J - 농촌', status: '가동 중' }
            ];
            
            console.log('더미 데이터 즉시 표시:', demoData);
            updateEquipmentCounts(demoData);
            renderEquipmentLocationTable(demoData);
            
            // 그 다음 CSV 데이터 시도
            fetch('청명장비 엑셀/serials.csv')
                .then(response => {
                    console.log('CSV 응답:', response);
                    return response.text();
                })
                .then(data => {
                    console.log('CSV 데이터 로드됨:', data.substring(0, 200));
                    const lines = data.split('\n');
                    const equipmentData = [];
                    
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i];
                        if (line.trim()) {
                            const parts = line.split(',');
                            if (parts.length >= 3) {
                                equipmentData.push({
                                    name: parts[1] || '알 수 없음',
                                    serial: parts[2] || 'N/A',
                                    location: getRandomLocation(),
                                    status: getRandomStatus()
                                });
                            }
                        }
                    }
                    
                    if (equipmentData.length > 0) {
                        console.log('CSV 데이터로 업데이트:', equipmentData);
                        updateEquipmentCounts(equipmentData);
                        renderEquipmentLocationTable(equipmentData);
                    }
                })
                .catch(error => {
                    console.error('장비 데이터 로드 실패:', error);
                    console.log('더미 데이터 유지');
                });
        }

        function updateEquipmentCounts(equipmentData) {
            console.log('updateEquipmentCounts 함수 실행됨:', equipmentData);
            
            const total = equipmentData.length;
            const operating = equipmentData.filter(item => item.status === '가동 중').length;
            const repair = equipmentData.filter(item => item.status === '수리 중').length;
            const waiting = equipmentData.filter(item => item.status === '대기 중').length;
            
            console.log('계산된 수량:', { total, operating, repair, waiting });
            
            const totalElement = document.getElementById('equipment-total');
            const operatingElement = document.getElementById('equipment-operating');
            const repairElement = document.getElementById('equipment-repair');
            const waitingElement = document.getElementById('equipment-waiting');
            
            if (totalElement) totalElement.textContent = total;
            if (operatingElement) operatingElement.textContent = operating;
            if (repairElement) repairElement.textContent = repair;
            if (waitingElement) waitingElement.textContent = waiting;
            
            console.log('수량 업데이트 완료');
        }

        function renderEquipmentLocationTable(equipmentData) {
            console.log('renderEquipmentLocationTable 함수 실행됨:', equipmentData);
            
            const tableBody = document.getElementById('equipment-location-table');
            if (!tableBody) {
                console.error('equipment-location-table 요소를 찾을 수 없습니다.');
                return;
            }
            
            tableBody.innerHTML = '';
            
            equipmentData.forEach(item => {
                const row = `
                    <tr class="border-b hover:bg-slate-50">
                        <td class="p-4 font-medium text-slate-900">${item.name}</td>
                        <td class="p-4 text-slate-600">${item.serial}</td>
                        <td class="p-4 text-slate-600">${item.location}</td>
                        <td class="p-4">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(item.status)}">
                                ${item.status}
                            </span>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
            
            console.log('테이블 렌더링 완료');
        }

        function searchEquipment() {
            const searchInput = document.getElementById('equipment-search');
            const serial = searchInput.value.trim();
            
            if (!serial) {
                alert('일련번호를 입력해주세요.');
                return;
            }
            
            // CSV에서 검색 시도
            fetch('청명장비 엑셀/serials.csv')
                .then(response => response.text())
                .then(data => {
                    const lines = data.split('\n');
                    let found = false;
                    
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i];
                        if (line.trim()) {
                            const parts = line.split(',');
                            if (parts.length >= 3 && parts[2].trim() === serial) {
                                const name = parts[1] || '알 수 없음';
                                displayEquipmentDetail(name, serial, 85, 2, '2025-02-15');
                                found = true;
                                break;
                            }
                        }
                    }
                    
                    if (!found) {
                        // 더미 데이터로 대체
                        displayEquipmentDetail('(PM-10) MP-가30KN가', serial, 88, 1, '2025-02-20');
                    }
                })
                .catch(error => {
                    console.error('검색 실패:', error);
                    // 더미 데이터로 대체
                    displayEquipmentDetail('(PM-10) MP-가30KN가', serial, 88, 1, '2025-02-20');
                });
        }

        function displayEquipmentDetail(name, serial, uptime, repairCount, calibration) {
            const detailArea = document.getElementById('equipment-detail');
            if (!detailArea) return;
            
            detailArea.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4">장비 상세 정보</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p><strong>장비명:</strong> ${name}</p>
                            <p><strong>일련번호:</strong> ${serial}</p>
                            <p><strong>가동률:</strong> ${uptime}%</p>
                        </div>
                        <div>
                            <p><strong>수리 횟수:</strong> ${repairCount}회</p>
                            <p><strong>정도검사 예정일:</strong> ${calibration}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function showRepairDetail(serial) {
            const repairDetails = {
                '770654': {
                    parts: ['센서 모듈', '전원부'],
                    costs: [450000, 180000],
                    company: '정밀기기솔루션',
                    description: '센서 모듈 교체 및 전원부 수리'
                },
                '17-1733': {
                    parts: ['유량 센서', '보정 장치'],
                    costs: [320000, 150000],
                    company: '기기수리센터',
                    description: '유량 센서 교체 및 보정 작업'
                },
                '1501478': {
                    parts: ['모터 드라이브', '제어 보드'],
                    costs: [280000, 220000],
                    company: '환경측정기기',
                    description: '모터 드라이브 교체 및 제어 보드 수리'
                }
            };
            
            const detail = repairDetails[serial] || {
                parts: ['일반 부품'],
                costs: [150000],
                company: '수리업체',
                description: '일반 수리 작업'
            };
            
            const modal = document.getElementById('repairDetailModal');
            if (modal) {
                const content = modal.querySelector('.modal-content');
                content.innerHTML = `
                    <h3 class="text-lg font-semibold mb-4">수리 상세 정보</h3>
                    <p><strong>일련번호:</strong> ${serial}</p>
                    <p><strong>수리 업체:</strong> ${detail.company}</p>
                    <p><strong>교체 부품:</strong></p>
                    <ul class="list-disc list-inside ml-4 mb-4">
                        ${detail.parts.map((part, index) => 
                            `<li>${part} - ${detail.costs[index].toLocaleString()}원</li>`
                        ).join('')}
                    </ul>
                    <p><strong>작업 내용:</strong> ${detail.description}</p>
                    <p><strong>총 비용:</strong> ${detail.costs.reduce((a, b) => a + b, 0).toLocaleString()}원</p>
                `;
                modal.classList.remove('hidden');
            }
        }

        function closeRepairModal() {
            const modal = document.getElementById('repairDetailModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        function handlePdfUpload(event) {
            const file = event.target.files[0];
            if (file && file.type === 'application/pdf') {
                alert('PDF 파일이 업로드되었습니다: ' + file.name);
            } else {
                alert('PDF 파일만 업로드 가능합니다.');
            }
        }

        function uploadRepairReport() {
            alert('수리 내역이 성공적으로 업로드되었습니다.');
        }

        function openManual(manualType) {
            const manualTitles = {
                'pm10': 'PM-10 측정기 사용 매뉴얼 v2.1',
                'so2': 'SO2 분석기 운영 가이드 v1.8',
                'pm25': 'PM-2.5 측정기 설치 매뉴얼 v3.0',
                'general': '장비 일반 운영 매뉴얼 v2.5'
            };
            
            alert(`${manualTitles[manualType]}이 열렸습니다.`);
        }

        function openTraining(trainingType) {
            const trainingTitles = {
                'basic': '장비 기본 조작 교육 자료',
                'maintenance': '정기 점검 및 유지보수 교육',
                'troubleshooting': '장비 고장 진단 및 해결 방법',
                'safety': '안전 수칙 및 응급 상황 대처법'
            };
            
            alert(`${trainingTitles[trainingType]}이 열렸습니다.`);
        }

        function getRandomLocation() {
            const locations = [
                '본사 실험실 A동', '본사 실험실 B동', '본사 실험실 C동', '본사 창고',
                '현장 A - 측정소', '현장 B - 공장', '현장 C - 발전소', '현장 D - 정유소',
                '현장 E - 도시', '현장 F - 산업단지', '현장 G - 항만', '현장 H - 공항',
                '현장 I - 도로변', '현장 J - 농촌'
            ];
            return locations[Math.floor(Math.random() * locations.length)];
        }

        function getRandomStatus() {
            const statuses = ['가동 중', '수리 중', '점검 중', '대기 중'];
            return statuses[Math.floor(Math.random() * statuses.length)];
        }

        function getStatusColor(status) {
            switch (status) {
                case '가동 중': return 'bg-green-100 text-green-800';
                case '수리 중': return 'bg-yellow-100 text-yellow-800';
                case '점검 중': return 'bg-blue-100 text-blue-800';
                case '대기 중': return 'bg-slate-100 text-slate-800';
                default: return 'bg-slate-100 text-slate-800';
            }
        }

        function loadRepairStatus() {
            console.log('수리 현황 로드됨');
            // 수리 현황은 이미 HTML에 하드코딩되어 있음
        }

        function loadEducationMaterials() {
            console.log('교육 자료 로드됨');
            // 교육 자료는 이미 HTML에 하드코딩되어 있음
        }

        window.switchEquipmentTab = function(tabName) {
            console.log('switchEquipmentTab 함수 실행됨:', tabName);
            
            // 모든 탭 내용 숨기기
            document.querySelectorAll('.equipment-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // 모든 탭 버튼 비활성화
            document.querySelectorAll('.equipment-tab').forEach(tab => {
                tab.classList.remove('active', 'border-indigo-500', 'text-indigo-600');
                tab.classList.add('text-slate-500');
            });
            
            // 선택된 탭 내용 표시
            const targetTab = document.getElementById(`equipment-${tabName}`);
            if (targetTab) {
                targetTab.classList.remove('hidden');
                console.log(`${tabName} 탭 내용 표시됨`);
            } else {
                console.error(`equipment-${tabName} 요소를 찾을 수 없습니다.`);
            }
            
            // 선택된 탭 버튼 활성화
            const activeTab = document.querySelector(`[onclick="switchEquipmentTab('${tabName}')"]`);
            if (activeTab) {
                activeTab.classList.add('active', 'border-indigo-500', 'text-indigo-600');
                activeTab.classList.remove('text-slate-500');
                console.log(`${tabName} 탭 버튼 활성화됨`);
            } else {
                console.error(`${tabName} 탭 버튼을 찾을 수 없습니다.`);
            }
            
            // 탭별 초기화
            if (tabName === 'status') {
                console.log('현황 탭 초기화 시작');
                loadEquipmentStatus();
            } else if (tabName === 'repair') {
                console.log('수리 탭 초기화 시작');
                loadRepairStatus();
            } else if (tabName === 'education') {
                console.log('교육 탭 초기화 시작');
                loadEducationMaterials();
            }
        };

        // 전역 함수로 switchView 정의 (HTML에서 호출 가능하도록)
        window.switchView = function(viewId) {
            document.querySelectorAll('.view-section').forEach(section => section.classList.add('hidden'));
            
            // 장비 관련 뷰들을 equipment-view로 통합
            if (viewId === 'equipment-status' || viewId === 'equipment-repair' || viewId === 'equipment-education') {
                console.log('장비 관련 뷰 처리:', viewId);
                const equipmentView = document.getElementById('equipment-view');
                if (equipmentView) {
                    equipmentView.classList.remove('hidden');
                    console.log('equipment-view 표시됨');
                    // 해당 탭으로 자동 전환
                    const tabName = viewId.replace('equipment-', '');
                    console.log('탭 전환:', tabName);
                    switchEquipmentTab(tabName);
                } else {
                    console.error('equipment-view 요소를 찾을 수 없습니다.');
                }
            } else if (viewId === 'alarm-equipment') {
                document.getElementById('alarm-equipment-view').classList.remove('hidden');
                renderEquipmentAlarmTable();
            } else if (viewId === 'alarm-accounting') {
                document.getElementById('alarm-accounting-view').classList.remove('hidden');
                renderAccountingAlarmTable();
            } else if (viewId === 'accounting-purchase-request' || viewId === 'accounting-quote' || viewId === 'accounting-transaction') {
                document.getElementById(viewId + '-view').classList.remove('hidden');
            } else {
                document.getElementById(viewId + '-view').classList.remove('hidden');
            }

            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active-nav'));
            const navItem = document.querySelector(`[onclick="switchView('${viewId}')"]`);
            if (navItem) {
                navItem.classList.add('active-nav');
            }
            
            if (viewId === 'dashboard') {
                initDashboardCharts();
                updateKpis();
            } else if (viewId === 'alarms') {
                renderAlarmsTable();
            } else if (viewId === 'accounting-purchase-request') {
                // 물품구매요구서 양식 초기화
                const tableBody = document.getElementById('item-details-table');
                if (tableBody && tableBody.children.length === 0) {
                    for (let i = 0; i < 12; i++) {
                        addItemRow();
                    }
                }
            } else if (viewId === 'accounting-quote') {
                // 견적서 관련 초기화
            } else if (viewId === 'accounting-transaction') {
                // 거래명세서 관련 초기화
            }
        };

        // 전역 함수들 정의 (HTML에서 호출 가능하도록)
        window.showDetail = function(sn) {
            const item = mockData.equipment.find(e => e.sn === sn);
            if (!item) return;

            document.getElementById('modal-sn').textContent = sn;
            const modalContent = document.querySelector('#detailModal .overflow-y-auto');
            
            const repairs = mockData.repairHistory[sn] || [];
            const movements = mockData.movementHistory[sn] || [];

            modalContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-slate-50 p-4 rounded-md">
                        <h4 class="font-bold text-slate-700 mb-2">기본 정보</h4>
                        <p><strong>품목 계열:</strong> ${item.category}</p>
                        <p><strong>모델명:</strong> ${item.model}</p>
                        <p><strong>현재 상태:</strong> ${item.status}</p>
                        <p><strong>현재 위치:</strong> ${item.location}</p>
                    </div>
                     <div class="bg-slate-50 p-4 rounded-md">
                        <h4 class="font-bold text-slate-700 mb-2">정도검사 기록부</h4>
                        <ul class="list-disc list-inside text-indigo-600">
                            <li><a href="#" class="hover:underline">검사기록부_${sn}_202501.pdf</a></li>
                            <li><a href="#" class="hover:underline">검사기록부_${sn}_202401.pdf</a></li>
                        </ul>
                    </div>
                </div>
                <div class="mt-6">
                    <h4 class="font-bold text-slate-700 mb-2">수리 이력</h4>
                    <table class="w-full text-left text-sm">
                        <thead class="bg-slate-100"><tr><th class="p-2">일자</th><th class="p-2">업체</th><th class="p-2">내용</th><th class="p-2 text-right">비용</th></tr></thead>
                        <tbody>${repairs.map(r => `
                            <tr class="border-b"><td class="p-2">${r.date}</td><td class="p-2">${r.company}</td><td class="p-2">${r.details}</td><td class="p-2 text-right">${r.cost.toLocaleString()}원</td></tr>
                        `).join('') || `<tr><td colspan="4" class="p-2 text-center text-slate-500">수리 이력이 없습니다.</td></tr>`}
                        </tbody>
                    </table>
                </div>
                 <div class="mt-6">
                    <h4 class="font-bold text-slate-700 mb-2">이동 이력</h4>
                    <table class="w-full text-left text-sm">
                        <thead class="bg-slate-100"><tr><th class="p-2">일자</th><th class="p-2">형태</th><th class="p-2">위치/현장</th></tr></thead>
                        <tbody>${movements.map(m => `
                            <tr class="border-b"><td class="p-2">${m.date}</td><td class="p-2">${m.type}</td><td class="p-2">${m.location}</td></tr>
                        `).join('') || `<tr><td colspan="3" class="p-2 text-center text-slate-500">이동 이력이 없습니다.</td></tr>`}
                        </tbody>
                    </table>
                </div>
            `;
            document.getElementById('detailModal').classList.remove('hidden');
            document.getElementById('detailModal').classList.add('flex');
        };

        window.closeModal = function(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        };
        
        window.saveRepairData = function() {
            alert('수리 내역이 성공적으로 저장되었습니다.');
            window.closeModal('verificationModal');
        };
    });
</script>
</body>
</html>